{"version":3,"file":"static/js/688.30b45f39.chunk.js","mappings":"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","sources":["components/ServedFrom.tsx","components/Version.tsx","components/DeployInfo.tsx","capabilities/cardBadgesCapability.ts","capabilities/capabilitiesInitilizer.ts","capabilities/boardButtonCapability.ts","capabilities/cardBackSectionCapability.ts","capabilities/listActionsCapability.ts","pages/CapabilitiesInitializerPage.tsx","pages/IndexPage.tsx","router/components/AppLink.tsx","router/routePathUrl.ts","utils/dateFormatting.ts","utils/exitTime.ts","utils/urlUtils.ts"],"sourcesContent":["import React from \"react\";\n\nexport function ServedFrom() {\n    return (\n        <>\n            Served from: {window.location.host}\n        </>\n    );\n}\n","import React from \"react\";\n\nexport function Version() {\n    return (\n        <>\n            Version: {process.env.REACT_APP_VERSION}\n        </>\n    );\n}\n","import React from \"react\";\n\nimport \"./DeployInfo.scss\";\nimport { ServedFrom } from \"./ServedFrom\";\nimport { Version } from \"./Version\";\n\ntype Props = {\n    className?: string;\n}\n\nexport function DeployInfo(props: Props) {\n    return (\n        <div className={props.className}>\n            <span className=\"deploy-text\">\n                <Version />\n            </span>\n            <span className=\"deploy-text\">\n                <ServedFrom />\n            </span>\n        </div>\n    );\n}\n","import { Trello } from \"../types/trello\";\nimport { getCardEstimate, getCurrentWork, getRemainingWorkMinutes, getTotalWorkMinutes } from \"../api/estimateApi\";\nimport { formatMinutes } from \"../utils/timeParsing\";\nimport { getElapsedMinutes } from \"../utils/dateMath\";\nimport { formatWorkDelta, getWorkDelta } from \"../utils/workDelta\";\n\nasync function getBadge(t: Trello.PowerUp.IFrame, icon: string): Promise<Trello.PowerUp.CardBadge> {\n    const card = await t.card(\"id\", \"dueComplete\");\n    const estimate = await getCardEstimate(t);\n    const currentWork = await getCurrentWork(t);\n\n    let totalWork = getTotalWorkMinutes(estimate);\n    let remainingWork = getRemainingWorkMinutes(estimate, card.dueComplete, totalWork);\n\n    if (estimate.estimateMinutes === 0 && totalWork === 0 && currentWork?.cardId !== card.id)\n        throw t.NotHandled();\n\n    if (currentWork?.cardId === card.id) {\n        const currentMinutes = getElapsedMinutes(currentWork.startDate);\n        totalWork += currentMinutes;\n        remainingWork -= currentMinutes;\n    }\n\n    const workPart = totalWork > 0\n        ? `| W: ${formatMinutes(totalWork)}`\n        : \"\"\n    ;\n\n    const delta = getWorkDelta({\n        cardId: card.id,\n        estimate,\n        totalWorkMinutes: totalWork,\n    });\n\n    const lastPart = !card.dueComplete\n        ? `| R: ${formatMinutes(remainingWork)}`\n        : delta !== 0\n            ? `| ${formatWorkDelta({\n                delta,\n                short: true,\n            })}`\n            : \"\"\n    ;\n\n    return {\n        text: `E: ${formatMinutes(estimate.updatedEstimateMinutes || estimate.estimateMinutes)} ${workPart} ${lastPart}`,\n        icon: icon,\n        color: card.id === currentWork?.cardId\n            ? \"red\"\n            : card.dueComplete\n                ? delta >= 0 ? \"green\" : \"yellow\"\n                : undefined,\n        refresh: 10, // in seconds\n    };\n}\n\nexport function getCardBadges(t: Trello.PowerUp.IFrame, props: CapabilityProps): Trello.PowerUp.CardBadgeDynamic[] {\n    return [{\n        dynamic: () => {\n            return getBadge(t, props.icon.light);\n        },\n    }];\n}\n","import { Trello } from \"../types/trello\";\nimport { getUrl } from \"../utils/urlUtils\";\nimport { getBoardButton } from \"./boardButtonCapability\";\nimport { getCardBackSection } from \"./cardBackSectionCapability\";\nimport { getCardBadges } from \"./cardBadgesCapability\";\nimport { getListActions } from \"./listActionsCapability\";\n\nconst CAPABILITY_PROPS: CapabilityProps = {\n    icon: {\n        dark: getUrl(\"/logo192.png\", { absolute: true }),\n        light: getUrl(\"/logo192.png\", { absolute: true }),\n    },\n};\n\nexport function initializeCapabilities() {\n    console.log(\"initializing capabilities\");\n\n    window.TrelloPowerUp.initialize({\n        \"board-buttons\": (t: Trello.PowerUp.IFrame) => getBoardButton(t, CAPABILITY_PROPS),\n        \"card-back-section\": (t: Trello.PowerUp.IFrame) => getCardBackSection(t, CAPABILITY_PROPS),\n        \"card-badges\": (t: Trello.PowerUp.IFrame) => getCardBadges(t, CAPABILITY_PROPS),\n        \"list-actions\": (t: Trello.PowerUp.IFrame) => getListActions(t, CAPABILITY_PROPS),\n    });\n}\n","import { getRoutePathUrl } from \"../router/routePathUrl\";\nimport { Trello } from \"../types/trello\";\n\nexport function getBoardButton(_t: Trello.PowerUp.IFrame, props: CapabilityProps): Trello.PowerUp.BoardButtonCallback[] {\n    return [{\n        icon: {\n            dark: props.icon.dark,\n            light: props.icon.light,\n        },\n        text: \"Estimate\",\n        callback: (tc: Trello.PowerUp.IFrame) => {\n            return tc.modal({\n                title: \"Estimate\",\n                url: tc.signUrl(getRoutePathUrl(\"/board-page\")),\n                fullscreen: false,\n                height: 400,\n            });\n        },\n        condition: \"edit\",\n    }];\n}\n","import { getRoutePathUrl } from \"../router/routePathUrl\";\nimport { Trello } from \"../types/trello\";\n\nexport function getCardBackSection(t: Trello.PowerUp.IFrame, props: CapabilityProps): Trello.PowerUp.CardBackSection {\n    return {\n        title: \"Estimate\",\n        icon: props.icon.dark,\n        content: {\n            type: \"iframe\",\n            url: t.signUrl(getRoutePathUrl(\"/card-back-section\", { absolute: true })),\n            height: 210,\n        },\n    };\n}\n","import { getRoutePathUrl } from \"../router/routePathUrl\";\r\nimport { Trello } from \"../types/trello\";\r\n\r\nexport async function getListActions(t: Trello.PowerUp.IFrame, props: CapabilityProps): Promise<Trello.PowerUp.ListAction[]> {\r\n    return [{\r\n        text: \"Show list estimate summary\",\r\n        callback: async (tc: Trello.PowerUp.IFrame) => {\r\n            return tc.popup({\r\n                title: \"List estimate summary\",\r\n                url: tc.signUrl(getRoutePathUrl(\"/list-summary\")),\r\n            });\r\n        },\r\n    }];\r\n}\r\n","import { initializeCapabilities } from \"../capabilities/capabilitiesInitilizer\";\nimport { addListenerToSaveExitTime } from \"../utils/exitTime\";\nimport IndexPage from \"./IndexPage\";\n\ninitializeCapabilities();\naddListenerToSaveExitTime();\n\nexport default IndexPage;\n","import React from \"react\";\n\nimport \"./IndexPage.scss\";\nimport logo from \"../assets/e.png\";\nimport { AppLink } from \"../router/components/AppLink\";\nimport { DeployInfo } from \"../components/DeployInfo\";\n\nexport default function IndexPage() {\n    return (\n        <div className={\"App\"}>\n            <header className=\"App-header\">\n                <img\n                    src={logo}\n                    className=\"App-logo\"\n                    alt=\"logo\"\n                />\n                <p>\n                    This is the Estimate Trello Powerup welcome page.\n                </p>\n                <DeployInfo />\n                <AppLink to={\"/dummy\"}>\n                    Dummy page\n                </AppLink>\n                <AppLink to={\"/board-page\"}>\n                    Board page\n                </AppLink>\n                <AppLink to={\"/card-back-section\"}>\n                    Card back section page\n                </AppLink>\n            </header>\n        </div>\n    );\n}\n","import React from \"react\";\nimport { getRoutePathUrl } from \"../routePathUrl\";\n\ntype AnchorProps = React.DetailedHTMLProps<React.AnchorHTMLAttributes<HTMLAnchorElement>, HTMLAnchorElement>;\n\ntype Props = Omit<AnchorProps, \"href\"> & {\n    to: RoutePath\n}\n\nexport function AppLink(props: Props) {\n    return (\n        <a\n            {...props}\n            href={getRoutePathUrl(props.to)}\n        >\n            {props.children}\n        </a>\n    );\n}\n","import { getUrl, UrlOptions } from \"../utils/urlUtils\";\n\nexport function getRoutePathUrl(path: RoutePath, options?: UrlOptions) {\n    return getUrl(\"?path=\" + path, options);\n}\n","export type DateFormat =\r\n    \"yyyy-MM-dd\"\r\n    | \"yyyy-MM-dd hh:mm:ss\"\r\n;\r\n\r\nexport function formatDate(date: Date, format: DateFormat = \"yyyy-MM-dd\") {\r\n    return format\r\n        .replaceAll(\"yyyy\", date.getFullYear().toString())\r\n        .replaceAll(\"MM\", (date.getMonth() + 1).toString().padStart(2, \"0\"))\r\n        .replaceAll(\"dd\", date.getDate().toString().padStart(2, \"0\"))\r\n        .replaceAll(\"hh\", date.getHours().toString().padStart(2, \"0\"))\r\n        .replaceAll(\"mm\", date.getMinutes().toString().padStart(2, \"0\"))\r\n        .replaceAll(\"ss\", date.getSeconds().toString().padStart(2, \"0\"));\r\n}\r\n","import { formatDate } from \"./dateFormatting\";\r\n\r\nconst key = \"exit.datetime\";\r\n\r\nexport function addListenerToSaveExitTime() {\r\n    window.addEventListener(\"pagehide\", e => {\r\n        localStorage.setItem(key, JSON.stringify(new Date()));\r\n        // localStorage.setItem(\"pagehide\", JSON.stringify(new Date()));\r\n    });\r\n\r\n    // window.addEventListener(\"visibilitychange\", e => {\r\n    //     localStorage.setItem(\"visibilitychange.\" + document.visibilityState, JSON.stringify(new Date()));\r\n    // });\r\n\r\n    const lastExitTime = getLastExitTime();\r\n    console.log(key + \": \" + (lastExitTime ? formatDate(lastExitTime, \"yyyy-MM-dd hh:mm:ss\") : \"null\"));\r\n}\r\n\r\nexport function getLastExitTime() {\r\n    const saved = JSON.parse(localStorage.getItem(key) as string);\r\n\r\n    if (saved)\r\n        return new Date(saved);\r\n\r\n    return null;\r\n}\r\n","export type UrlOptions = {\n    absolute?: boolean,\n}\n\nexport function getUrl(endpoint: string, options?: UrlOptions) {\n    const relative = process.env.PUBLIC_URL + endpoint;\n\n    if (options?.absolute)\n        return window.location.origin + relative;\n    else\n        return relative;\n}\n"],"names":["ServedFrom","window","location","host","Version","process","DeployInfo","props","className","getCardBadges","t","dynamic","async","icon","card","estimate","getCardEstimate","currentWork","getCurrentWork","totalWork","getTotalWorkMinutes","remainingWork","getRemainingWorkMinutes","dueComplete","estimateMinutes","cardId","id","NotHandled","currentMinutes","getElapsedMinutes","startDate","workPart","formatMinutes","delta","getWorkDelta","totalWorkMinutes","lastPart","formatWorkDelta","short","text","updatedEstimateMinutes","color","undefined","refresh","getBadge","light","CAPABILITY_PROPS","dark","getUrl","absolute","console","log","TrelloPowerUp","initialize","getBoardButton","callback","tc","modal","title","url","signUrl","getRoutePathUrl","fullscreen","height","condition","content","type","getCardBackSection","popup","getListActions","addListenerToSaveExitTime","IndexPage","src","logo","alt","to","AppLink","href","children","path","options","formatDate","date","format","replaceAll","getFullYear","toString","getMonth","padStart","getDate","getHours","getMinutes","getSeconds","key","addEventListener","e","localStorage","setItem","JSON","stringify","Date","lastExitTime","getLastExitTime","saved","parse","getItem","endpoint","relative","origin"],"sourceRoot":""}