{"version":3,"file":"static/js/880.d0cf9213.chunk.js","mappings":"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","sources":["api/estimateApi.ts","utils/truncate.ts","components/WorkButton.tsx","hooks/useCard.ts","hooks/useCurrentWork.ts","hooks/useElapsed.ts","hooks/useMember.ts","hooks/useProvidedTrello.ts","hooks/useTrelloRender.ts","jk/hooks/useInit.ts","jk/noDeps.ts","utils/dateMath.ts","utils/mathParsing.ts","utils/timeParsing.ts","utils/workSessionsUtils.ts"],"sourcesContent":["import { Trello } from \"../types/trello\";\n\nexport type UserMinutes = {\n    [key: string]: number,\n}\n\nexport type Estimate = {\n    estimateMinutes: number,\n    workMinutes: UserMinutes,\n}\n\nexport type SummaryEstimate = {\n    estimateMinutes: number,\n    workMinutes: number,\n    remainingMinutes: number,\n}\n\nexport type CurrentWork = {\n    cardId: string,\n    startDate: Date,\n}\n\nexport type WorkSession = {\n    startDate: Date,\n    endDate?: Date,\n    workMinutes: number,\n}\n\nexport async function getMyWorkMinutes(estimate: Estimate, t: Trello.PowerUp.IFrame): Promise<number> {\n    const me = await t.member(\"id\");\n    return estimate.workMinutes[me.id];\n}\n\nexport function getTotalWorkMinutes(estimate: Estimate) {\n    let sum = 0;\n    for (const workerId in estimate.workMinutes)\n        sum += estimate.workMinutes[workerId];\n    return sum;\n}\n\nexport function getRemainingWorkMinutes(estimate: Estimate, dueComplete: boolean, totalWorkMinutes?: number) {\n    if (dueComplete)\n        return 0;\n\n    if (totalWorkMinutes === undefined)\n        totalWorkMinutes = getTotalWorkMinutes(estimate);\n\n    return estimate.estimateMinutes - totalWorkMinutes;\n}\n\nexport function* enumerateWork(estimate: Estimate) {\n    for (const memberId in estimate.workMinutes) {\n        yield {\n            memberId,\n            minutes: estimate.workMinutes[memberId],\n        };\n    }\n}\n\nexport async function getCardEstimate(t: Trello.PowerUp.IFrame, cardId?: string): Promise<Estimate> {\n    const estimate = JSON.parse(await t.get(cardId ?? \"card\", \"shared\", \"estimate\", \"null\")) as Estimate;\n    if (estimate === null) {\n        return {\n            estimateMinutes: 0,\n            workMinutes: {},\n        };\n    }\n    return estimate;\n}\n\nexport async function setCardEstimate(t: Trello.PowerUp.IFrame, estimate: Estimate, cardId?: string) {\n    await t.set(cardId ?? \"card\", \"shared\", \"estimate\", JSON.stringify(estimate));\n    return estimate;\n}\n\nexport async function getAllCardsEstimates(t: Trello.PowerUp.IFrame, ...fields: (keyof Trello.PowerUp.Card)[]) {\n    if (fields === undefined || fields.length === 0)\n        fields = [\"id\"];\n\n    const cards: Trello.PowerUp.Card[] = await t.cards(...fields);\n    return await Promise.all(cards.map(card =>\n        getCardEstimate(t, card.id).then(estimate => ({\n            ...estimate,\n            card: card,\n        }))));\n}\n\nexport async function getBoardEstimates(t: Trello.PowerUp.IFrame) {\n    const estimates = await getAllCardsEstimates(t, \"id\", \"dueComplete\");\n\n    const summary: SummaryEstimate = {\n        estimateMinutes: 0,\n        workMinutes: 0,\n        remainingMinutes: 0,\n    };\n\n    for (const est of estimates) {\n        summary.estimateMinutes += est.estimateMinutes;\n        summary.workMinutes += getTotalWorkMinutes(est);\n\n        const remaining = getRemainingWorkMinutes(est, est.card.dueComplete);\n        summary.remainingMinutes += remaining > 0 ? remaining : 0;\n    }\n\n    return summary;\n}\n\nexport async function getCurrentWork(t: Trello.PowerUp.IFrame) {\n    // console.log(\"getting current work\");\n\n    const currentWork = JSON.parse(await t.get(\"board\", \"private\", \"work\", \"null\")) as CurrentWork | null;\n\n    if (currentWork !== null)\n        // js parses dates as strings so i have to convert it here\n        currentWork.startDate = new Date(currentWork.startDate);\n\n    return currentWork;\n}\n\nexport async function setCurrentWork(t: Trello.PowerUp.IFrame, currentWork: CurrentWork | null) {\n    // console.log(\"setting current work\");\n    await t.set(\"board\", \"private\", \"work\", JSON.stringify(currentWork ?? null));\n}\n\nexport async function getWorkSessions(t: Trello.PowerUp.IFrame) {\n    const sessions = JSON.parse(await t.get(\"board\", \"private\", \"work_sessions\", \"[]\")) as WorkSession[];\n\n    for (const s of sessions) {\n        s.startDate = new Date(s.startDate);\n        if (s.endDate !== undefined)\n            s.endDate = new Date(s.endDate);\n    }\n\n    return sessions;\n}\n\nexport async function setWorkSessions(t: Trello.PowerUp.IFrame, sessions: WorkSession[]) {\n    await t.set(\"board\", \"private\", \"work_sessions\", JSON.stringify(sessions));\n}\n\nconst maxWorkSessions = 5;\n\nfunction addWorkSession(sessions: WorkSession[]) {\n    if (sessions.length >= maxWorkSessions)\n        sessions.shift();\n\n    const added: WorkSession = {\n        startDate: new Date(),\n        workMinutes: 0,\n    };\n\n    sessions.push(added);\n\n    return added;\n}\n\nexport async function editCurrentWorkSession(t: Trello.PowerUp.IFrame, action: (session: WorkSession) => Promise<WorkSession>) {\n    const sessions = await getWorkSessions(t);\n    let current = sessions[sessions.length - 1];\n\n    if (current === undefined || current.endDate !== undefined)\n        current = addWorkSession(sessions);\n\n    sessions[sessions.length - 1] = await action(current);\n\n    await setWorkSessions(t, sessions);\n}\n","\nexport function truncateString(str: string, maxLength = 10) {\n    if (str.length < maxLength)\n        return str;\n    else\n        return str.substring(0, maxLength - 3) + \"...\";\n}\n","import React from \"react\";\n\nimport { useCurrentWork } from \"../hooks/useCurrentWork\";\nimport { useCardById, useProvidedCard } from \"../hooks/useCard\";\nimport { getCardEstimate, setCardEstimate } from \"../api/estimateApi\";\nimport { useElapsedMinutes } from \"../hooks/useElapsed\";\nimport { formatMinutesWithOptions, hoursPerDay } from \"../utils/timeParsing\";\nimport { truncateString } from \"../utils/truncate\";\nimport { useProvidedTrello } from \"../hooks/useProvidedTrello\";\nimport { useMember } from \"../hooks/useMember\";\nimport { addMinutesToDate, getElapsedSeconds } from \"../utils/dateMath\";\nimport { askToCloseOldSession, closeIfOldAndEditCurrentWorkSession } from \"../utils/workSessionsUtils\";\n\ntype Props = {\n    onEstimateChanged?: () => void;\n}\n\nexport function WorkButton(props: Props) {\n    const t = useProvidedTrello();\n    const currentWork = useCurrentWork();\n    const elapsedWorkMinutes = useElapsedMinutes(currentWork.value?.startDate);\n    const providedCard = useProvidedCard(\"id\");\n    const workCard = useCardById(t, currentWork.value?.cardId, \"id\", \"name\");\n    const member = useMember(t, \"id\");\n\n    const isWorking = currentWork.value?.cardId !== undefined && !currentWork.isSaving;\n\n    return (providedCard || isWorking\n        ? <button\n            className={`work-button ${!isWorking ? \"mod-primary\" : \"mod-danger\"}`}\n            onClick={async e => {\n                if (member === undefined)\n                    return;\n\n                if (!isWorking && providedCard !== undefined) {\n                    currentWork.set({\n                        cardId: providedCard.id,\n                        startDate: new Date(),\n                    });\n\n                    askToCloseOldSession(t, {\n                        hoursPerDay,\n                        mouseEvent: e,\n                    });\n                }\n                else if (isWorking) {\n                    const seconds = Math.round(getElapsedSeconds(currentWork.value!.startDate));\n                    const minutes = seconds / 60;\n\n                    currentWork.set(null);\n\n                    const estimate = await getCardEstimate(t, currentWork.value!.cardId);\n                    await setCardEstimate(\n                        t,\n                        {\n                            ...estimate,\n                            workMinutes: {\n                                ...estimate.workMinutes,\n                                [member.id]: (estimate.workMinutes[member.id] ?? 0) + minutes,\n                            },\n                        },\n                        currentWork.value!.cardId,\n                    );\n\n                    await closeIfOldAndEditCurrentWorkSession(t, {\n                        action: async session => {\n                            if (session.workMinutes === 0)\n                                session.startDate = addMinutesToDate(session.startDate, -minutes);\n                            session.workMinutes += minutes;\n                            return session;\n                        },\n                        hoursPerDay,\n                        mouseEvent: e,\n                    });\n\n                    props.onEstimateChanged?.();\n                }\n            }}\n        >\n            {currentWork.isSaving && \"...\"}\n            {(!isWorking && !currentWork.isSaving) ? \"Start work\" : \"End work\"}\n            {isWorking && \" \" + formatMinutesWithOptions(elapsedWorkMinutes, { zero: \"\" })}\n            {isWorking && providedCard?.id !== currentWork.value?.cardId\n                && ` (on${providedCard ? \" other\" : \"\"} card${workCard === undefined ? \"\" : `: \"${truncateString(workCard.name, 8)}\"`})`\n            }\n        </button>\n        : <p>\n            No work is being time-tracked.\n        </p>\n    );\n}\n","import { useEffect, useMemo, useState } from \"react\";\nimport { Trello } from \"../types/trello\";\n\nimport { noDeps } from \"../jk/noDeps\";\nimport { useProvidedTrello } from \"./useProvidedTrello\";\nimport { useTrelloRender } from \"./useTrelloRender\";\n\nexport function useCardWithRefresh(t: Trello.PowerUp.IFrame, ...fields: (keyof Trello.PowerUp.Card)[]) {\n    const [card, setCard] = useState<Trello.PowerUp.Card>();\n\n    const refresh = useMemo(\n        () => async () => {\n            let fetched: Trello.PowerUp.Card;\n\n            try {\n                fetched = await t.card(...fields);\n            }\n            catch (error) {\n                console.warn(\"no card in context\");\n                return;\n            }\n\n            setCard(fetched);\n        },\n        noDeps,\n    );\n\n    useTrelloRender(t, refresh);\n\n    return useMemo(\n        () => ({\n            card,\n            refresh,\n        }),\n        [card],\n    );\n}\n\nexport function useCard(t: Trello.PowerUp.IFrame, ...fields: (keyof Trello.PowerUp.Card)[]) {\n    const { card } = useCardWithRefresh(t, ...fields);\n    return card;\n}\n\nexport function useProvidedCard(...fields: (keyof Trello.PowerUp.Card)[]) {\n    const t = useProvidedTrello();\n    return useCard(t, ...fields);\n}\n\nexport function useCardById(t: Trello.PowerUp.IFrame, cardId: string | undefined, ...fields: (keyof Trello.PowerUp.Card)[]) {\n    const [card, setCard] = useState<Trello.PowerUp.Card>();\n\n    useEffect(\n        () => {\n            async function refresh() {\n                if (cardId === undefined)\n                    return;\n\n                const cards = await t.cards(...fields);\n                for (const c of cards) {\n                    if (c.id === cardId) {\n                        setCard(c);\n                        break;\n                    }\n                }\n            }\n            refresh();\n            t.render(refresh);\n        },\n        [cardId],\n    );\n\n    return card;\n}\n","import { useMemo, useState } from \"react\";\nimport { useQuery, useQueryClient } from \"react-query\";\n\nimport { CurrentWork, getCurrentWork, setCurrentWork } from \"../api/estimateApi\";\nimport { Trello } from \"../types/trello\";\nimport { minutesToMs } from \"../utils/timeParsing\";\nimport { useInit } from \"../jk/hooks/useInit\";\nimport { useProvidedTrello } from \"./useProvidedTrello\";\n\nconst queryKey = \"current_work\";\n\nexport function useCurrentWorkQuery(t: Trello.PowerUp.IFrame) {\n    // N.B. la query sembra che non venga cachata, penso che il motivo sia che\n    // ogni volta che viene aperta una scheda viene avviata una nuova\n    // istanza di react\n    return useQuery(\n        queryKey,\n        () => getCurrentWork(t),\n        {\n            staleTime: minutesToMs(2),\n            cacheTime: Infinity,\n            refetchOnMount: false,\n            refetchOnReconnect: false,\n            refetchOnWindowFocus: false,\n        },\n    );\n}\n\nexport function useCurrentWork() {\n    const t = useProvidedTrello();\n    const queryClient = useQueryClient();\n    const query = useCurrentWorkQuery(t);\n    const [isSaving, setIsSaving] = useState(false);\n\n    // console.log(\"query stale: \" + query.isStale);\n\n    useInit(() => {\n        t.render(() => {\n            // console.log(\"rendering so refetch\");\n            query.refetch();\n        });\n    });\n\n    const set = useMemo(\n        () => async (updated: CurrentWork | null) => {\n            setIsSaving(true);\n            await setCurrentWork(t, updated);\n            // console.log(\"setting query data\");\n            queryClient.setQueryData(queryKey, updated);\n            setIsSaving(false);\n        },\n        [t, queryClient],\n    );\n\n    return useMemo(\n        () => ({\n            value: query.data,\n            isSaving,\n            set,\n        }),\n        [query.data, isSaving, set],\n    );\n}\n","import { useEffect, useState } from \"react\";\nimport { getElapsedMs } from \"../utils/dateMath\";\n\nexport function useElapsedMinutes(startDate: Date | undefined) {\n    return useElapsedMs(startDate) / 1000 / 60;\n}\n\nexport function useElapsedSeconds(startDate: Date | undefined) {\n    return useElapsedMs(startDate) / 1000;\n}\n\nexport function useElapsedMs(startDate: Date | undefined) {\n    const [ms, setMs] = useState(0);\n\n    useEffect(\n        () => {\n            if (startDate === undefined) {\n                setMs(0);\n                return;\n            }\n\n            // TODO: per rendere più efficente dopo che gli ms passati\n            // sono >= 1 minuto potrei passare a un set interval della\n            // durata di un minuto\n\n            let animationFrameId: number;\n            let canceled = false;\n\n            function updateSeconds() {\n                setMs(getElapsedMs(startDate!));\n\n                if (!canceled)\n                    animationFrameId = requestAnimationFrame(updateSeconds);\n            }\n\n            animationFrameId = requestAnimationFrame(updateSeconds);\n\n            return () => {\n                canceled = true;\n                cancelAnimationFrame(animationFrameId);\n            };\n        },\n        [startDate],\n    );\n\n    return ms;\n}\n","import { useEffect, useState } from \"react\";\n\nimport { Trello } from \"../types/trello\";\nimport { useProvidedTrello } from \"./useProvidedTrello\";\n\nexport function useMember(t: Trello.PowerUp.IFrame, ...fields: [\"all\"] | Trello.PowerUp.MemberFields[]) {\n    const state = useState<Trello.PowerUp.Member>();\n    const [member, setMember] = state;\n\n    useEffect(\n        () => {\n            const actualFields = fields !== undefined && fields.length > 0\n                ? fields\n                : [\"id\"] as Trello.PowerUp.MemberFields[];\n            t.member(...actualFields).then(res => setMember(res));\n        },\n        [t],\n    );\n\n    return member;\n}\n\nexport function useProvidedMember(...fields: [\"all\"] | Trello.PowerUp.MemberFields[]) {\n    const t = useProvidedTrello();\n    return useMember(t, ...fields);\n}\n","import { Trello } from \"../types/trello\";\n\nlet t: Trello.PowerUp.IFrame;\n\nexport function useProvidedTrello() {\n    if (t === undefined) {\n        t = window.TrelloPowerUp.iframe({\n            appName: process.env.REACT_APP_POWERUP_NAME,\n            appKey: process.env.REACT_APP_POWERUP_APP_KEY,\n        });\n    }\n\n    return t;\n}\n","import { Trello } from \"../types/trello\";\nimport { useInit } from \"../jk/hooks/useInit\";\nimport { useProvidedTrello } from \"./useProvidedTrello\";\n\nexport type TrelloRenderOptions = {\n    refresh: () => void;\n    callImmediately?: boolean;\n}\n\nexport function useTrelloRenderWithOptions(t: Trello.PowerUp.IFrame, options: TrelloRenderOptions) {\n    useInit(() => {\n        if (options.callImmediately)\n            options.refresh();\n        t.render(options.refresh);\n    });\n}\n\nexport function useTrelloRender(t: Trello.PowerUp.IFrame, refresh: () => void) {\n    return useTrelloRenderWithOptions(t, {\n        refresh,\n        callImmediately: true,\n    });\n}\n\nexport function useProvidedTrelloRender(refresh: () => void) {\n    const t = useProvidedTrello();\n    return useTrelloRender(t, refresh);\n}\n","import React, { useEffect } from \"react\";\nimport { noDeps } from \"../noDeps\";\n\nexport function useInit(effect: React.EffectCallback) {\n    return useEffect(effect, noDeps);\n}\n","export const noDeps = [];\n","import { minutesToMs } from \"./timeParsing\";\n\nexport function addMinutesToDate(date: Date, minutes: number) {\n    return new Date(date.getTime() + minutesToMs(minutes));\n}\n\nexport function getElapsedMs(date: Date) {\n    return Date.now() - date.getTime();\n}\n\nexport function getElapsedSeconds(date: Date) {\n    return getElapsedMs(date) / 1000;\n}\n\nexport function getElapsedMinutes(date: Date) {\n    return getElapsedMs(date) / 1000 / 60;\n}\n","\nexport function evaluateMathExpression(expression: string) {\n    if (/^[0-9.()+*-/]+$/.test(expression)) {\n        try {\n            return eval(expression) as number;\n        }\n        catch (error) {\n            return NaN;\n        }\n    }\n    else {\n        return NaN;\n    }\n}\n","import { evaluateMathExpression } from \"./mathParsing\";\n\nexport function parseTimeDelta(timeDeltaString: string) {\n    timeDeltaString = timeDeltaString.replaceAll(\" \", \"\");\n    timeDeltaString = timeDeltaString.replaceAll(\",\", \".\");\n    timeDeltaString = timeDeltaString.toLowerCase();\n\n    if (!/^([^a-z]+[a-z]+)+$/.test(timeDeltaString)) {\n        // console.log(\"desk rejected\");\n        return NaN;\n    }\n\n    let minutes = 0;\n\n    for (const match of timeDeltaString.matchAll(/([^a-z]+)([a-z]+)/g)) {\n        const timeLabel = match[2];\n\n        if (timeLabel.length !== 1)\n            return NaN;\n\n        let multiplier: number;\n\n        if (timeLabel === \"m\")\n            multiplier = 1;\n        else if (timeLabel === \"h\")\n            multiplier = 60;\n        else\n            return NaN;\n\n        const expressionResult = evaluateMathExpression(match[1]);\n\n        if (isNaN(expressionResult))\n            return NaN;\n\n        minutes += multiplier * expressionResult;\n    }\n\n    if (minutes <= 0)\n        return NaN;\n\n    return minutes;\n}\n\nexport const hoursPerDay = 8;\n\nexport type FormatMinutesOptions = {\n    zero: string,\n    negative: string,\n    hoursPerDay: number,\n}\n\nconst defaultOptions: FormatMinutesOptions = {\n    zero: \"none\",\n    negative: \"?\",\n    hoursPerDay: 8,\n};\n\nexport function formatMinutes(minutes: number) {\n    return formatMinutesWithOptions(minutes );\n}\n\nexport function formatMinutesWithOptions(minutes: number, options: Partial<FormatMinutesOptions> = defaultOptions) {\n    if (isNaN(minutes))\n        return \"NaN\";\n\n    if (minutes < 0)\n        return options.negative ?? defaultOptions.negative;\n\n    if (minutes === 0)\n        return options.zero ?? defaultOptions.zero;\n\n    const hoursPerDay = options.hoursPerDay ?? defaultOptions.hoursPerDay;\n\n    let minutesPart = Math.floor(minutes % 60);\n    const flooredHours = Math.floor(minutes / 60);\n    const hoursPart = flooredHours % hoursPerDay;\n    const daysPart = Math.floor(flooredHours / hoursPerDay);\n\n    let secondsPart = 0;\n\n    // show seconds only if minutes < 1\n    if (minutes < 1) {\n        secondsPart = Math.round(minutes * 60);\n        minutesPart = 0;\n    }\n\n    let str = \"\";\n\n    if (daysPart > 0)\n        str += daysPart + \"d\";\n    if (hoursPart > 0)\n        str += hoursPart + \"h\";\n    if (minutesPart > 0)\n        str += minutesPart + \"m\";\n    if (secondsPart > 0)\n        str += secondsPart + \"s\";\n\n    return str;\n}\n\nexport function minutesToMs(minutes: number) {\n    return minutes * 60 * 1000;\n}\n\nexport function hoursToMs(hours: number) {\n    return minutesToMs(hours * 60);\n}\n\nexport function msToMinutes(ms: number) {\n    return (ms / 1000) / 60;\n}\n","import { Trello } from \"../types/trello\";\nimport { editCurrentWorkSession, getWorkSessions, setWorkSessions, WorkSession } from \"../api/estimateApi\";\nimport { formatMinutesWithOptions, hoursToMs, msToMinutes } from \"./timeParsing\";\nimport { getElapsedMs } from \"./dateMath\";\n\ntype Options = {\n    hoursPerDay: number,\n    mouseEvent: React.MouseEvent<HTMLButtonElement, MouseEvent>,\n}\n\ntype AskOptions = Options & {\n    action?: () => Promise<void>,\n}\n\ntype EditOptions = Options & {\n    action: (session: WorkSession) => Promise<WorkSession>,\n}\n\nexport async function askToCloseOldSession(t: Trello.PowerUp.IFrame, options: AskOptions): Promise<void> {\n    const sessions = await getWorkSessions(t);\n    const current = sessions[sessions.length - 1];\n\n    if (current === undefined || current.endDate !== undefined)\n        return options.action?.();\n\n    const sessionAgeMs = getElapsedMs(current.startDate);\n\n    if (sessionAgeMs < hoursToMs(options.hoursPerDay * 2))\n        return options.action?.();\n\n    const formattedAge = formatMinutesWithOptions(msToMinutes(sessionAgeMs), {\n        hoursPerDay: 24,\n    });\n\n    return new Promise((resolve, reject) => {\n        t.popup({\n            type: \"confirm\",\n            title: \"Close old session?\",\n            message: `The current session looks old (${formattedAge}), do you want to close it and open a new one to save this work?`,\n            confirmText: \"Yes\",\n            onConfirm: async tp => {\n                current.endDate = new Date();\n                await setWorkSessions(t, sessions);\n                resolve(options.action?.());\n                await tp.closePopup();\n            },\n            cancelText: \"No\",\n            onCancel: tp => {\n                resolve(options.action?.());\n                return tp.closePopup();\n            },\n            mouseEvent: options.mouseEvent.nativeEvent,\n        });\n    });\n}\n\nexport function closeIfOldAndEditCurrentWorkSession(t: Trello.PowerUp.IFrame, options: EditOptions) {\n    return askToCloseOldSession(t, {\n        action: () => editCurrentWorkSession(t, options.action),\n        hoursPerDay: options.hoursPerDay,\n        mouseEvent: options.mouseEvent,\n    });\n}\n"],"names":["enumerateWork","getTotalWorkMinutes","estimate","sum","workerId","workMinutes","getRemainingWorkMinutes","dueComplete","totalWorkMinutes","undefined","estimateMinutes","memberId","minutes","getCardEstimate","t","cardId","JSON","get","parse","setCardEstimate","set","stringify","getAllCardsEstimates","fields","length","cards","Promise","all","map","card","id","then","getBoardEstimates","estimates","summary","remainingMinutes","est","remaining","getCurrentWork","currentWork","startDate","Date","setCurrentWork","getWorkSessions","sessions","s","endDate","setWorkSessions","addWorkSession","shift","added","push","editCurrentWorkSession","action","current","truncateString","str","maxLength","substring","WorkButton","props","useProvidedTrello","useCurrentWork","elapsedWorkMinutes","useElapsedMinutes","value","providedCard","useProvidedCard","workCard","useCardById","member","useMember","isWorking","isSaving","className","onClick","e","askToCloseOldSession","hoursPerDay","mouseEvent","seconds","Math","round","getElapsedSeconds","closeIfOldAndEditCurrentWorkSession","session","addMinutesToDate","onEstimateChanged","formatMinutesWithOptions","zero","name","useCardWithRefresh","useState","setCard","refresh","useMemo","fetched","console","warn","noDeps","useTrelloRender","useCard","useEffect","c","render","queryKey","queryClient","useQueryClient","query","useQuery","staleTime","minutesToMs","cacheTime","Infinity","refetchOnMount","refetchOnReconnect","refetchOnWindowFocus","useCurrentWorkQuery","setIsSaving","useInit","refetch","updated","setQueryData","data","useElapsedMs","ms","setMs","animationFrameId","canceled","requestAnimationFrame","updateSeconds","getElapsedMs","cancelAnimationFrame","state","setMember","actualFields","res","window","TrelloPowerUp","iframe","appName","process","appKey","useTrelloRenderWithOptions","options","callImmediately","effect","date","getTime","now","getElapsedMinutes","evaluateMathExpression","expression","test","NaN","eval","error","parseTimeDelta","timeDeltaString","replaceAll","toLowerCase","matchAll","match","timeLabel","multiplier","expressionResult","isNaN","defaultOptions","negative","formatMinutes","minutesPart","floor","flooredHours","hoursPart","daysPart","secondsPart","hoursToMs","hours","msToMinutes","sessionAgeMs","formattedAge","resolve","reject","popup","type","title","message","confirmText","onConfirm","tp","closePopup","cancelText","onCancel","nativeEvent"],"sourceRoot":""}