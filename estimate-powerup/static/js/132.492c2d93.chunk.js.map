{"version":3,"file":"static/js/132.492c2d93.chunk.js","mappings":"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","sources":["utils/object.ts","utils/trelloRest.ts","utils/fetch.ts","components/CompleteCardButton.tsx","components/OpenWorkCardButton.tsx","components/WorkDetails.tsx","components/TimeButtons.tsx","pages/CardBackSectionPage.tsx","hooks/useEstimate.ts"],"sourcesContent":["export function* enumerateKeys<T>(object: T): Generator<keyof T> {\n    for (const key in object)\n        yield key;\n}\n","import { Trello } from \"../types/trello\";\nimport { fetchJson } from \"./fetch\";\nimport { enumerateKeys } from \"./object\";\n\nconst baseurl = \"https://api.trello.com/1\";\n\nconst apiKey = process.env.REACT_APP_POWERUP_APP_KEY;\n\nexport function getAuthorizedRestApi(t: Trello.PowerUp.IFrame, scope: Trello.PowerUp.AllPermissions = \"read,write\") {\n    return t.getRestApi()\n        .isAuthorized()\n        .then(authorized => {\n            if (authorized)\n                return;\n            else\n                throw new Error(\"unauthorized\");\n        })\n        .catch(() => {\n            return t.getRestApi().authorize({\n                scope,\n            });\n        })\n        .then(() => {\n            return t.getRestApi().getToken();\n        });\n}\n\nexport function getCardFields(token: string, cardId: string, ...fields: [\"all\"] | (keyof Trello.PowerUp.Card)[]) {\n    if (fields === undefined || fields.length === 0)\n        fields = [\"all\"];\n\n    return fetchJson<Trello.PowerUp.Card>({\n        url: baseurl + `/cards/${cardId}?fields=${fields.join(\",\")}&key=${apiKey}&token=${token}`,\n        method: \"GET\",\n    });\n}\n\nexport type EditableCard = Partial<Omit<Trello.PowerUp.Card, \"id\" | \"idShort\" | \"url\">>;\n\nexport function updateCardFields(token: string, cardId: string, fields: EditableCard) {\n    const query = {\n        ...fields,\n        key: apiKey,\n        token: token,\n    };\n\n    const queryString = Array.from(enumerateKeys(query), key => key + \"=\" + query[key]).join(\"&\");\n\n    return fetchJson<Trello.PowerUp.Card>({\n        url: baseurl + `/cards/${cardId}?${queryString}`,\n        method: \"PUT\",\n    });\n}\n","export type Request = RequestInit & {\n    url: RequestInfo | URL;\n}\n\nexport type JsonResponse<T> = Response & {\n    data: T;\n    request: Request\n}\n\nexport function fetchJson<T>(request: Request): Promise<JsonResponse<T>> {\n    return fetch(request.url, {\n        ...request,\n        headers: {\n            Accept: \"application/json\",\n            ...request?.headers,\n        },\n    })\n        .then(response => {\n            return response.json().then(json => {\n                const jsonResponse = response as JsonResponse<T>;\n                jsonResponse.data = json;\n                jsonResponse.request = request;\n                return jsonResponse;\n            });\n        });\n}\n","import React from \"react\";\n\nimport { useCard, useCardDueCompletedQuery } from \"../hooks/useCard\";\nimport { useProvidedTrello } from \"../hooks/useProvidedTrello\";\nimport { If } from \"../jk/types/jsxControlStatements\";\nimport { getAuthorizedRestApi, updateCardFields } from \"../utils/trelloRest\";\n\ntype Props = {\n    className?: string;\n}\n\nexport function CompleteCardButton(props: Props) {\n    const t = useProvidedTrello();\n    const card = useCard(t, \"id\", \"due\");\n    const dueCompleteQuery = useCardDueCompletedQuery(t);\n\n    return (\n        <button\n            className={`complete-work ${props.className}`}\n            onClick={() => {\n                if (card === undefined)\n                    return;\n\n                getAuthorizedRestApi(t)\n                    .then(token => updateCardFields(token, card.id, {\n                        due: dueCompleteQuery.data\n                            ? null\n                            : card.due\n                                ? card.due\n                                : new Date().toISOString(),\n                        dueComplete: !dueCompleteQuery.data,\n                    }))\n                    .then(response => {\n                        if (response.ok)\n                            dueCompleteQuery.setData(response.data.dueComplete);\n                    })\n                    .catch(err => {\n                        console.error(err);\n                    });\n            }}\n        >\n            <If condition={dueCompleteQuery.data === undefined}>\n                loading...\n            </If>\n            <If condition={dueCompleteQuery.data !== undefined}>\n                <If condition={dueCompleteQuery.data}>\n                    Uncomplete card\n                </If>\n                <If condition={!dueCompleteQuery.data}>\n                    Complete card\n                </If>\n            </If>\n        </button>\n    );\n}\n","import React from \"react\";\nimport { useCard } from \"../hooks/useCard\";\n\nimport { useCurrentWork } from \"../hooks/useCurrentWork\";\nimport { useProvidedTrello } from \"../hooks/useProvidedTrello\";\n\ntype Props = {\n    className?: string;\n}\n\nexport function OpenWorkCardButton(props: Props) {\n    const t = useProvidedTrello();\n    const currentWork = useCurrentWork();\n    const card = useCard(t, \"id\");\n\n    if (currentWork.value?.cardId === undefined)\n        return null;\n\n    if (card === undefined || currentWork.value.cardId === card.id)\n        return null;\n\n    return (\n        <button\n            className={`open-work ${props.className}`}\n            onClick={() => t.showCard(currentWork.value!.cardId)}\n        >\n            Open work card\n        </button>\n    );\n}\n","import React, { useEffect, useState } from \"react\";\n\nimport { enumerateWork, Estimate, getRemainingWorkMinutes, getTotalWorkMinutes } from \"../api/estimateApi\";\nimport { formatMinutes } from \"../utils/timeParsing\";\nimport { useCard, useCardDueCompletedQuery } from \"../hooks/useCard\";\nimport { useProvidedTrello } from \"../hooks/useProvidedTrello\";\nimport { Trello } from \"../types/trello\";\nimport { useCurrentWork } from \"../hooks/useCurrentWork\";\nimport { useElapsedMinutes } from \"../hooks/useElapsed\";\nimport { If } from \"../jk/types/jsxControlStatements\";\nimport { formatWorkDelta, getWorkDelta } from \"../utils/workDelta\";\n\ntype Props = {\n    estimate: Estimate,\n    member: Trello.PowerUp.Member,\n}\n\ntype MembersObject = {\n    [key: Trello.PowerUp.Member[\"id\"]]: Trello.PowerUp.Member,\n}\n\nexport function WorkDetails(props: Props) {\n    const { estimate, member } = props;\n    const [showDetails, setShowDetails] = useState(false);\n    const [members, setMembers] = useState<MembersObject>();\n\n    const t = useProvidedTrello();\n    const card = useCard(t, \"id\");\n    const dueCompleteQuery = useCardDueCompletedQuery(t);\n    const isCardComplete = dueCompleteQuery.data ?? false;\n\n    const currentWork = useCurrentWork();\n    const elapsedWorkMinutes = useElapsedMinutes(\n        currentWork.value?.cardId === card?.id\n            ? currentWork.value?.startDate\n            : undefined,\n    );\n\n    useEffect(\n        () => {\n            if (!showDetails || members !== undefined)\n                return;\n\n            t.board(\"members\").then(res => {\n                const obj: MembersObject = {};\n                for (const m of res.members)\n                    obj[m.id] = m;\n                setMembers(obj);\n            });\n        },\n        [showDetails, members],\n    );\n\n    const totalWork = getTotalWorkMinutes(estimate) + elapsedWorkMinutes;\n    const myWork = elapsedWorkMinutes + estimate.workMinutes[member.id!] ?? 0;\n    const remainingWork = getRemainingWorkMinutes(estimate, isCardComplete, totalWork);\n\n    return (\n        <>\n            <div className='card-label'>\n                Work: {formatMinutes(totalWork)}\n                {\" \"}\n                <If condition={myWork < totalWork}>\n                    (mine: {formatMinutes(myWork)})\n                </If>\n                {\" \"}\n                <If condition={myWork < totalWork}>\n                    <span\n                        className='work-details link-like'\n                        onClick={() => setShowDetails(current => !current)}\n                    >\n                        details\n                    </span>\n                </If>\n                <If condition={!isCardComplete}>\n                    {\" | \"} Remaining: {formatMinutes(remainingWork)}\n                </If>\n                <If condition={isCardComplete}>\n                    {\" | \"}\n                    {formatWorkDelta({\n                        delta: getWorkDelta({\n                            cardId: card?.id,\n                            estimate,\n                            totalWorkMinutes: totalWork,\n                        }),\n                    })}\n                </If>\n            </div>\n            <If condition={showDetails && members !== undefined}>\n                <div>\n                    {[...enumerateWork(estimate)]\n                        .filter(item => item.minutes > 0)\n                        .map(item => {\n                            const member = members![item.memberId];\n                            return (\n                                <div key={item.memberId}>\n                                    {member?.fullName ?? \"<missing>\"}\n                                    {member && \" \"}\n                                    {member !== undefined ? `(${member.username})` : \"\"}\n                                    {\": \"}\n                                    {formatMinutes(item.minutes)}\n                                </div>\n                            );\n                        })\n                    }\n                </div>\n            </If>\n        </>\n    );\n}\n","import React from \"react\";\n\nimport \"./TimeButtons.scss\";\n\ntype Props = {\n    label: React.ReactNode;\n    action: (\n        e: React.MouseEvent<HTMLButtonElement, MouseEvent>,\n        computeNew: (previous: number, parsed: number) => number\n    ) => void;\n    clearAction: (e: React.MouseEvent<HTMLButtonElement, MouseEvent>) => void;\n    setLabel?: string;\n    clearLabel?: string;\n    className?: string;\n}\n\nexport function TimeButtons(props: Props) {\n    return (\n        <div className={`time-buttons ${props.className ?? \"\"}`}>\n            <div className='label'>\n                {props.label}\n            </div>\n            <button onClick={e => props.action(e, (_, parsed) => parsed)}>\n                {props.setLabel ?? \"Set\"}\n            </button>\n            <button onClick={e => props.action(e, (previous, parsed) => previous + parsed)}>\n                +\n            </button>\n            <button onClick={e => props.action(e, (previous, parsed) => previous - parsed)}>\n                -\n            </button>\n            <button onClick={props.clearAction}>\n                {props.clearLabel ?? \"Clear\"}\n            </button>\n        </div>\n    );\n}\n","import React, { useState } from \"react\";\n\nimport \"./CardBackSectionPage.scss\";\nimport { formatMinutes, hoursPerDay, parseTimeDelta } from \"../utils/timeParsing\";\nimport { useMember } from \"../hooks/useMember\";\nimport { useEstimate } from \"../hooks/useEstimate\";\nimport { WorkButton } from \"../components/WorkButton\";\nimport { CompleteCardButton } from \"../components/CompleteCardButton\";\nimport { useProvidedTrello } from \"../hooks/useProvidedTrello\";\nimport { OpenWorkCardButton } from \"../components/OpenWorkCardButton\";\nimport { closeIfOldAndEditCurrentWorkSession } from \"../utils/workSessionsUtils\";\nimport { WorkDetails } from \"../components/WorkDetails\";\nimport { If } from \"../jk/types/jsxControlStatements\";\nimport { useTrelloRender } from \"../hooks/useTrelloRender\";\nimport { TimeButtons } from \"../components/TimeButtons\";\nimport { getUpdatedEstimate } from \"../api/estimateApi\";\n\nexport default function CardBackSectionPage() {\n    const t = useProvidedTrello();\n    const estimate = useEstimate(t);\n    const [inputEstimate, setInputEstimate] = useState<string>(\"\");\n    const member = useMember(t, \"id\");\n\n    useTrelloRender(t, estimate.refresh);\n\n    if (estimate.value === undefined)\n        return (<div>{estimate.feedback}</div>);\n\n    function parseAndRun<T>(action: (parsedMinutes: number) => T) {\n        const parsedMinutes = parseTimeDelta(inputEstimate);\n\n        if (isNaN(parsedMinutes)) {\n            t.alert({\n                display: \"error\",\n                message: \"invalid input\",\n                duration: 4,\n            });\n            return;\n        }\n\n        const val = action(parsedMinutes);\n\n        setInputEstimate(\"\");\n\n        return val;\n    }\n\n    function parseAndChangeWork(computeNewWork: (previousMinutes: number, parsedMinutes: number) => number) {\n        return parseAndRun(parsedMinutes =>\n            estimate.set(current => ({\n                ...current,\n                workMinutes: {\n                    ...current.workMinutes,\n                    [member!.id]: computeNewWork(current.workMinutes[member!.id] ?? 0, parsedMinutes),\n                },\n            })));\n    }\n\n    async function runAndUpdateSession(args: {\n        action: () => ReturnType<typeof estimate.set>,\n        mouseEvent: React.MouseEvent<HTMLButtonElement, MouseEvent>,\n    }) {\n        const delta = await args.action();\n\n        if (!delta)\n            return;\n\n        const myWorkDelta = delta.workMinutes[member!.id];\n        if (myWorkDelta === undefined)\n            return;\n\n        t.popup({\n            type: \"confirm\",\n            title: \"Add to session?\",\n            message: \"Should this work change count in your work session?\",\n            confirmText: \"Yes\",\n            onConfirm: tp => {\n                tp.closePopup();\n                return closeIfOldAndEditCurrentWorkSession(t, {\n                    action: async session => ({\n                        ...session,\n                        workMinutes: session.workMinutes + myWorkDelta,\n                    }),\n                    hoursPerDay,\n                    mouseEvent: args.mouseEvent,\n                });\n            },\n            cancelText: \"No\",\n            onCancel: tp => tp.closePopup(),\n            mouseEvent: args.mouseEvent.nativeEvent,\n        });\n    }\n\n    const hasUpdatedEstimate = estimate.value.updatedEstimateMinutes !== 0\n        && estimate.value.updatedEstimateMinutes !== estimate.value.estimateMinutes;\n\n    return (\n        <div>\n            <div className='card-input-header'>\n                <input\n                    value={inputEstimate}\n                    onChange={e => setInputEstimate(e.target.value)}\n                    placeholder=\"input for all buttons...\"\n                />\n                <WorkButton onEstimateChanged={estimate.refresh} />\n                <div className='top-right'>\n                    <OpenWorkCardButton />\n                    <CompleteCardButton />\n                </div>\n            </div>\n            <TimeButtons\n                label={<>\n                    {hasUpdatedEstimate && \"Original \"}\n                    Estimate: {formatMinutes(estimate.value.estimateMinutes)}\n                    <If condition={hasUpdatedEstimate}>\n                        {\" | \"}\n                        Updated: {formatMinutes(estimate.value.updatedEstimateMinutes!)}\n                    </If>\n                </>}\n                action={(e, computeNewEstimate) => parseAndRun(parsedMinutes => {\n                    if (estimate.value!.estimateMinutes === 0 && !hasUpdatedEstimate) {\n                        estimate.set(current => ({\n                            ...current,\n                            estimateMinutes: computeNewEstimate(current.estimateMinutes, parsedMinutes),\n                        }));\n                    }\n                    else {\n                        t.popup({\n                            type: \"confirm\",\n                            title: \"Update estimate?\",\n                            message: \"Do you want to update the estimate or change the original?\",\n                            confirmText: \"Update\",\n                            onConfirm: tp => {\n                                estimate.set(current => ({\n                                    ...current,\n                                    updatedEstimateMinutes: computeNewEstimate(\n                                        getUpdatedEstimate(current),\n                                        parsedMinutes,\n                                    ),\n                                }));\n                                return tp.closePopup();\n                            },\n                            cancelText: \"Change original\",\n                            onCancel: tp => {\n                                estimate.set(current => ({\n                                    ...current,\n                                    estimateMinutes: computeNewEstimate(\n                                        getUpdatedEstimate(current),\n                                        parsedMinutes,\n                                    ),\n                                    updatedEstimateMinutes: 0,\n                                }));\n                                return tp.closePopup();\n                            },\n                            mouseEvent: e.nativeEvent,\n                        });\n                    }\n                })}\n                clearAction={() => estimate.set(current => ({\n                    ...current,\n                    estimateMinutes: 0,\n                    updatedEstimateMinutes: 0,\n                }))}\n            />\n            <If condition={member !== undefined}>\n                <TimeButtons\n                    label= {<WorkDetails\n                        estimate={estimate.value}\n                        member={member!}\n                    />}\n                    action={(e, computeNewWork) => runAndUpdateSession({\n                        action: () => parseAndChangeWork(computeNewWork),\n                        mouseEvent: e,\n                    })}\n                    clearAction={e => runAndUpdateSession({\n                        action: () => estimate.set(current => ({\n                            ...current,\n                            workMinutes: {\n                                ...current.workMinutes,\n                                [member!.id]: 0,\n                            },\n                        })),\n                        mouseEvent: e,\n                    })}\n                    clearLabel=\"Clear mine\"\n                    className=\"work\"\n                />\n            </If>\n            <If condition={Boolean(estimate.feedback)}>\n                <div>\n                    {estimate.feedback}\n                </div>\n            </If>\n        </div>\n    );\n}\n","import { useState, useMemo } from \"react\";\n\nimport { Estimate, getCardEstimate, setCardEstimate } from \"../api/estimateApi\";\nimport { Trello } from \"../types/trello\";\nimport { noDeps } from \"../jk/noDeps\";\n\nexport function useEstimate(t: Trello.PowerUp.IFrame, autosave = true) {\n    const [estimate, setEstimate] = useState<Estimate>();\n    const [feedback, setFeedback] = useState(\"\");\n\n    const refresh = useMemo(\n        () => async () => {\n            setFeedback(\"loading...\");\n            const fetchedEstimate = await getCardEstimate(t);\n            setEstimate(fetchedEstimate);\n            setFeedback(\"\");\n        },\n        noDeps,\n    );\n\n    const set = useMemo(\n        () => (action: (estimate: Estimate) => Estimate) => {\n            if (estimate === undefined)\n                return;\n\n            const updated = action(estimate);\n\n            const delta: Estimate = {\n                estimateMinutes: updated.estimateMinutes - estimate.estimateMinutes,\n                updatedEstimateMinutes: updated.updatedEstimateMinutes - estimate.updatedEstimateMinutes,\n                workMinutes: {},\n            };\n\n            for (const memberId in updated.workMinutes)\n                delta.workMinutes[memberId] = updated.workMinutes[memberId] - (estimate.workMinutes[memberId] ?? 0);\n\n            if (!autosave)\n                return;\n\n            setFeedback(\"saving...\");\n\n            return getCardEstimate(t)\n                .then(remoteEstimate => {\n                    const updatedRemote: Estimate = {\n                        estimateMinutes: remoteEstimate.estimateMinutes + delta.estimateMinutes,\n                        updatedEstimateMinutes: remoteEstimate.updatedEstimateMinutes + delta.updatedEstimateMinutes,\n                        workMinutes: {},\n                    };\n\n                    for (const memberId in delta.workMinutes)\n                        updatedRemote.workMinutes[memberId] = (remoteEstimate.workMinutes[memberId] ?? 0) + delta.workMinutes[memberId];\n\n                    return setCardEstimate(t, updatedRemote);\n                })\n                .then(updatedRemote => {\n                    setEstimate(updatedRemote);\n                    setFeedback(\"saved!\");\n                    setTimeout(() => setFeedback(\"\"), 1000);\n                    return delta;\n                })\n                .catch(err => {\n                    setFeedback(\"\");\n                    t.alert({\n                        display: \"error\",\n                        message: `error during save: ${err}`,\n                    });\n                });\n        },\n        [estimate, autosave],\n    );\n\n    return useMemo(\n        () => ({\n            value: estimate,\n            set,\n            feedback,\n            refresh,\n        }),\n        [estimate, feedback],\n    );\n}\n\nexport type UsedEstimate = ReturnType<typeof useEstimate>;\n"],"names":["enumerateKeys","object","key","baseurl","apiKey","process","updateCardFields","token","cardId","fields","request","query","queryString","Array","from","join","url","method","fetch","headers","Accept","then","response","json","jsonResponse","data","CompleteCardButton","props","t","useProvidedTrello","card","useCard","dueCompleteQuery","useCardDueCompletedQuery","className","onClick","undefined","scope","getRestApi","isAuthorized","authorized","Error","catch","authorize","getToken","getAuthorizedRestApi","id","due","Date","toISOString","dueComplete","ok","setData","err","console","error","OpenWorkCardButton","currentWork","useCurrentWork","value","showCard","WorkDetails","estimate","member","useState","showDetails","setShowDetails","members","setMembers","isCardComplete","elapsedWorkMinutes","useElapsedMinutes","startDate","useEffect","board","res","obj","m","totalWork","getTotalWorkMinutes","myWork","workMinutes","remainingWork","getRemainingWorkMinutes","formatMinutes","current","formatWorkDelta","delta","getWorkDelta","totalWorkMinutes","enumerateWork","filter","item","minutes","map","memberId","fullName","username","TimeButtons","label","e","action","_","parsed","setLabel","previous","clearAction","clearLabel","CardBackSectionPage","autosave","setEstimate","feedback","setFeedback","refresh","useMemo","getCardEstimate","fetchedEstimate","noDeps","set","updated","estimateMinutes","updatedEstimateMinutes","remoteEstimate","updatedRemote","setCardEstimate","setTimeout","alert","display","message","useEstimate","inputEstimate","setInputEstimate","useMember","useTrelloRender","parseAndRun","parsedMinutes","parseTimeDelta","isNaN","val","duration","runAndUpdateSession","args","myWorkDelta","popup","type","title","confirmText","onConfirm","tp","closePopup","closeIfOldAndEditCurrentWorkSession","session","hoursPerDay","mouseEvent","cancelText","onCancel","nativeEvent","hasUpdatedEstimate","onChange","target","placeholder","WorkButton","onEstimateChanged","computeNewEstimate","getUpdatedEstimate","computeNewWork","parseAndChangeWork","Boolean"],"sourceRoot":""}