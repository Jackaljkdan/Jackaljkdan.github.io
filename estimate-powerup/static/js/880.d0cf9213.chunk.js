"use strict";(self.webpackChunkestimate_powerup=self.webpackChunkestimate_powerup||[]).push([[880],{4305:function(n,t,e){e.d(t,{Eo:function(){return v},TO:function(){return g},V9:function(){return f},Vc:function(){return w},Wm:function(){return l},X8:function(){return k},kS:function(){return y},oc:function(){return p},qH:function(){return N},tm:function(){return S},w9:function(){return b},y7:function(){return s}});var r=e(7762),u=e(1413),a=e(2982),o=e(8214),i=e(5861),c=(0,o.Z)().mark(l);function s(n){var t=0;for(var e in n.workMinutes)t+=n.workMinutes[e];return t}function f(n,t,e){return t?0:(void 0===e&&(e=s(n)),n.estimateMinutes-e)}function l(n){var t;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=(0,o.Z)().keys(n.workMinutes);case 1:if((e.t1=e.t0()).done){e.next=7;break}return t=e.t1.value,e.next=5,{memberId:t,minutes:n.workMinutes[t]};case 5:e.next=1;break;case 7:case"end":return e.stop()}}),c)}function p(n,t){return d.apply(this,arguments)}function d(){return(d=(0,i.Z)((0,o.Z)().mark((function n(t,e){var r;return(0,o.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.t0=JSON,n.next=3,t.get(null!==e&&void 0!==e?e:"card","shared","estimate","null");case 3:if(n.t1=n.sent,null!==(r=n.t0.parse.call(n.t0,n.t1))){n.next=7;break}return n.abrupt("return",{estimateMinutes:0,workMinutes:{}});case 7:return n.abrupt("return",r);case 8:case"end":return n.stop()}}),n)})))).apply(this,arguments)}function v(n,t,e){return h.apply(this,arguments)}function h(){return(h=(0,i.Z)((0,o.Z)().mark((function n(t,e,r){return(0,o.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.set(null!==r&&void 0!==r?r:"card","shared","estimate",JSON.stringify(e));case 2:return n.abrupt("return",e);case 3:case"end":return n.stop()}}),n)})))).apply(this,arguments)}function w(n){return m.apply(this,arguments)}function m(){return m=(0,i.Z)((0,o.Z)().mark((function n(t){var e,r,i,c,s=arguments;return(0,o.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:for(e=s.length,r=new Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=s[i];return void 0!==r&&0!==r.length||(r=["id"]),n.next=4,t.cards.apply(t,(0,a.Z)(r));case 4:return c=n.sent,n.next=7,Promise.all(c.map((function(n){return p(t,n.id).then((function(t){return(0,u.Z)((0,u.Z)({},t),{},{card:n})}))})));case 7:return n.abrupt("return",n.sent);case 8:case"end":return n.stop()}}),n)}))),m.apply(this,arguments)}function y(n){return Z.apply(this,arguments)}function Z(){return(Z=(0,i.Z)((0,o.Z)().mark((function n(t){var e,u,a,i,c,l;return(0,o.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,w(t,"id","dueComplete");case 2:e=n.sent,u={estimateMinutes:0,workMinutes:0,remainingMinutes:0},a=(0,r.Z)(e);try{for(a.s();!(i=a.n()).done;)c=i.value,u.estimateMinutes+=c.estimateMinutes,u.workMinutes+=s(c),l=f(c,c.card.dueComplete),u.remainingMinutes+=l>0?l:0}catch(o){a.e(o)}finally{a.f()}return n.abrupt("return",u);case 7:case"end":return n.stop()}}),n)})))).apply(this,arguments)}function k(n){return x.apply(this,arguments)}function x(){return(x=(0,i.Z)((0,o.Z)().mark((function n(t){var e;return(0,o.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.t0=JSON,n.next=3,t.get("board","private","work","null");case 3:return n.t1=n.sent,null!==(e=n.t0.parse.call(n.t0,n.t1))&&(e.startDate=new Date(e.startDate)),n.abrupt("return",e);case 7:case"end":return n.stop()}}),n)})))).apply(this,arguments)}function b(n,t){return D.apply(this,arguments)}function D(){return(D=(0,i.Z)((0,o.Z)().mark((function n(t,e){return(0,o.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.set("board","private","work",JSON.stringify(null!==e&&void 0!==e?e:null));case 2:case"end":return n.stop()}}),n)})))).apply(this,arguments)}function g(n){return M.apply(this,arguments)}function M(){return(M=(0,i.Z)((0,o.Z)().mark((function n(t){var e,u,a,i;return(0,o.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.t0=JSON,n.next=3,t.get("board","private","work_sessions","[]");case 3:n.t1=n.sent,e=n.t0.parse.call(n.t0,n.t1),u=(0,r.Z)(e);try{for(u.s();!(a=u.n()).done;)(i=a.value).startDate=new Date(i.startDate),void 0!==i.endDate&&(i.endDate=new Date(i.endDate))}catch(o){u.e(o)}finally{u.f()}return n.abrupt("return",e);case 8:case"end":return n.stop()}}),n)})))).apply(this,arguments)}function N(n,t){return _.apply(this,arguments)}function _(){return(_=(0,i.Z)((0,o.Z)().mark((function n(t,e){return(0,o.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.set("board","private","work_sessions",JSON.stringify(e));case 2:case"end":return n.stop()}}),n)})))).apply(this,arguments)}function E(n){n.length>=5&&n.shift();var t={startDate:new Date,workMinutes:0};return n.push(t),t}function S(n,t){return P.apply(this,arguments)}function P(){return(P=(0,i.Z)((0,o.Z)().mark((function n(t,e){var r,u;return(0,o.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,g(t);case 2:return r=n.sent,void 0!==(u=r[r.length-1])&&void 0===u.endDate||(u=E(r)),n.next=7,e(u);case 7:return r[r.length-1]=n.sent,n.next=10,N(t,r);case 10:case"end":return n.stop()}}),n)})))).apply(this,arguments)}},1880:function(n,t,e){e.d(t,{b:function(){return y}});var r=e(8214),u=e(4942),a=e(1413),o=e(5861),i=(e(2791),e(6258)),c=e(4303),s=e(4305),f=e(1166),l=e(5728);function p(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;return n.length<t?n:n.substring(0,t-3)+"..."}var d=e(146),v=e(6683),h=e(9697),w=e(8282),m=e(184);function y(n){var t,e,y,Z,k=(0,d.D)(),x=(0,i.k)(),b=(0,f.DP)(null===(t=x.value)||void 0===t?void 0:t.startDate),D=(0,c.th)("id"),g=(0,c.lg)(k,null===(e=x.value)||void 0===e?void 0:e.cardId,"id","name"),M=(0,v.K)(k,"id"),N=void 0!==(null===(y=x.value)||void 0===y?void 0:y.cardId)&&!x.isSaving;return D||N?(0,m.jsxs)("button",{className:"work-button ".concat(N?"mod-danger":"mod-primary"),onClick:function(){var t=(0,o.Z)((0,r.Z)().mark((function t(e){var i,c,f,p,d;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0!==M){t.next=2;break}return t.abrupt("return");case 2:if(N||void 0===D){t.next=7;break}x.set({cardId:D.id,startDate:new Date}),(0,w.j)(k,{hoursPerDay:l.xZ,mouseEvent:e}),t.next=19;break;case 7:if(!N){t.next=19;break}return f=Math.round((0,h.qG)(x.value.startDate)),p=f/60,x.set(null),t.next=13,(0,s.oc)(k,x.value.cardId);case 13:return d=t.sent,t.next=16,(0,s.Eo)(k,(0,a.Z)((0,a.Z)({},d),{},{workMinutes:(0,a.Z)((0,a.Z)({},d.workMinutes),{},(0,u.Z)({},M.id,(null!==(i=d.workMinutes[M.id])&&void 0!==i?i:0)+p))}),x.value.cardId);case 16:return t.next=18,(0,w.m)(k,{action:function(){var n=(0,o.Z)((0,r.Z)().mark((function n(t){return(0,r.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return 0===t.workMinutes&&(t.startDate=(0,h.HH)(t.startDate,-p)),t.workMinutes+=p,n.abrupt("return",t);case 3:case"end":return n.stop()}}),n)})));return function(t){return n.apply(this,arguments)}}(),hoursPerDay:l.xZ,mouseEvent:e});case 18:null===(c=n.onEstimateChanged)||void 0===c||c.call(n);case 19:case"end":return t.stop()}}),t)})));return function(n){return t.apply(this,arguments)}}(),children:[x.isSaving&&"...",N||x.isSaving?"End work":"Start work",N&&" "+(0,l.yz)(b,{zero:""}),N&&(null===D||void 0===D?void 0:D.id)!==(null===(Z=x.value)||void 0===Z?void 0:Z.cardId)&&" (on".concat(D?" other":""," card").concat(void 0===g?"":': "'.concat(p(g.name,8),'"'),")")]}):(0,m.jsx)("p",{children:"No work is being time-tracked."})}},4303:function(n,t,e){e.d(t,{lg:function(){return v},nb:function(){return p},th:function(){return d},w5:function(){return l}});var r=e(7762),u=e(8214),a=e(5861),o=e(885),i=e(2791),c=e(5678),s=e(146),f=e(9416);function l(n){for(var t=arguments.length,e=new Array(t>1?t-1:0),r=1;r<t;r++)e[r-1]=arguments[r];var s=(0,i.useState)(),l=(0,o.Z)(s,2),p=l[0],d=l[1],v=(0,i.useMemo)((function(){return(0,a.Z)((0,u.Z)().mark((function t(){var r;return(0,u.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,n.card.apply(n,e);case 3:r=t.sent,t.next=10;break;case 6:return t.prev=6,t.t0=t.catch(0),console.warn("no card in context"),t.abrupt("return");case 10:d(r);case 11:case"end":return t.stop()}}),t,null,[[0,6]])})))}),c.w);return(0,f.cM)(n,v),(0,i.useMemo)((function(){return{card:p,refresh:v}}),[p])}function p(n){for(var t=arguments.length,e=new Array(t>1?t-1:0),r=1;r<t;r++)e[r-1]=arguments[r];var u=l.apply(void 0,[n].concat(e)),a=u.card;return a}function d(){for(var n=(0,s.D)(),t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return p.apply(void 0,[n].concat(e))}function v(n,t){for(var e=arguments.length,c=new Array(e>2?e-2:0),s=2;s<e;s++)c[s-2]=arguments[s];var f=(0,i.useState)(),l=(0,o.Z)(f,2),p=l[0],d=l[1];return(0,i.useEffect)((function(){function e(){return o.apply(this,arguments)}function o(){return(o=(0,a.Z)((0,u.Z)().mark((function e(){var a,o,i,s;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==t){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,n.cards.apply(n,c);case 4:a=e.sent,o=(0,r.Z)(a),e.prev=6,o.s();case 8:if((i=o.n()).done){e.next=15;break}if((s=i.value).id!==t){e.next=13;break}return d(s),e.abrupt("break",15);case 13:e.next=8;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(6),o.e(e.t0);case 20:return e.prev=20,o.f(),e.finish(20);case 23:case"end":return e.stop()}}),e,null,[[6,17,20,23]])})))).apply(this,arguments)}e(),n.render(e)}),[t]),p}},6258:function(n,t,e){e.d(t,{k:function(){return d}});var r=e(8214),u=e(5861),a=e(885),o=e(2791),i=e(1933),c=e(4305),s=e(5728),f=e(1640),l=e(146),p="current_work";function d(){var n=(0,l.D)(),t=(0,i.useQueryClient)(),e=function(n){return(0,i.useQuery)(p,(function(){return(0,c.X8)(n)}),{staleTime:(0,s.y2)(2),cacheTime:1/0,refetchOnMount:!1,refetchOnReconnect:!1,refetchOnWindowFocus:!1})}(n),d=(0,o.useState)(!1),v=(0,a.Z)(d,2),h=v[0],w=v[1];(0,f.D)((function(){n.render((function(){e.refetch()}))}));var m=(0,o.useMemo)((function(){return function(){var e=(0,u.Z)((0,r.Z)().mark((function e(u){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return w(!0),e.next=3,(0,c.w9)(n,u);case 3:t.setQueryData(p,u),w(!1);case 5:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()}),[n,t]);return(0,o.useMemo)((function(){return{value:e.data,isSaving:h,set:m}}),[e.data,h,m])}},1166:function(n,t,e){e.d(t,{DP:function(){return o}});var r=e(885),u=e(2791),a=e(9697);function o(n){return i(n)/1e3/60}function i(n){var t=(0,u.useState)(0),e=(0,r.Z)(t,2),o=e[0],i=e[1];return(0,u.useEffect)((function(){if(void 0!==n){var t,e=!1;return t=requestAnimationFrame((function r(){i((0,a.ne)(n)),e||(t=requestAnimationFrame(r))})),function(){e=!0,cancelAnimationFrame(t)}}i(0)}),[n]),o}},6683:function(n,t,e){e.d(t,{K:function(){return o}});var r=e(2982),u=e(885),a=e(2791);function o(n){for(var t=arguments.length,e=new Array(t>1?t-1:0),o=1;o<t;o++)e[o-1]=arguments[o];var i=(0,a.useState)(),c=(0,u.Z)(i,2),s=c[0],f=c[1];return(0,a.useEffect)((function(){var t=void 0!==e&&e.length>0?e:["id"];n.member.apply(n,(0,r.Z)(t)).then((function(n){return f(n)}))}),[n]),s}},146:function(n,t,e){var r;function u(){return void 0===r&&(r=window.TrelloPowerUp.iframe({appName:"Estimate",appKey:"dadac0f685db6faecaa69b90f19ba321"})),r}e.d(t,{D:function(){return u}})},9416:function(n,t,e){e.d(t,{cM:function(){return a},he:function(){return u}});var r=e(1640);function u(n,t){(0,r.D)((function(){t.callImmediately&&t.refresh(),n.render(t.refresh)}))}function a(n,t){return u(n,{refresh:t,callImmediately:!0})}},1640:function(n,t,e){e.d(t,{D:function(){return a}});var r=e(2791),u=e(5678);function a(n){return(0,r.useEffect)(n,u.w)}},5678:function(n,t,e){e.d(t,{w:function(){return r}});var r=[]},9697:function(n,t,e){e.d(t,{HH:function(){return u},Zd:function(){return i},ne:function(){return a},qG:function(){return o}});var r=e(5728);function u(n,t){return new Date(n.getTime()+(0,r.y2)(t))}function a(n){return Date.now()-n.getTime()}function o(n){return a(n)/1e3}function i(n){return a(n)/1e3/60}},6733:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){function evaluateMathExpression(expression){if(!/^[0-9.()+*-/]+$/.test(expression))return NaN;try{return eval(expression)}catch(error){return NaN}}__webpack_require__.d(__webpack_exports__,{K:function(){return evaluateMathExpression}})},5728:function(n,t,e){e.d(t,{JB:function(){return c},Nw:function(){return a},do:function(){return p},fg:function(){return l},xZ:function(){return o},y2:function(){return f},yz:function(){return s}});var r=e(7762),u=e(6733);function a(n){if(n=(n=(n=n.replaceAll(" ","")).replaceAll(",",".")).toLowerCase(),!/^([^a-z]+[a-z]+)+$/.test(n))return NaN;var t,e=0,a=(0,r.Z)(n.matchAll(/([^a-z]+)([a-z]+)/g));try{for(a.s();!(t=a.n()).done;){var o=t.value,i=o[2];if(1!==i.length)return NaN;var c=void 0;if("m"===i)c=1;else{if("h"!==i)return NaN;c=60}var s=(0,u.K)(o[1]);if(isNaN(s))return NaN;e+=c*s}}catch(f){a.e(f)}finally{a.f()}return e<=0?NaN:e}var o=8,i={zero:"none",negative:"?",hoursPerDay:8};function c(n){return s(n)}function s(n){var t,e,r,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i;if(isNaN(n))return"NaN";if(n<0)return null!==(t=u.negative)&&void 0!==t?t:i.negative;if(0===n)return null!==(e=u.zero)&&void 0!==e?e:i.zero;var a=null!==(r=u.hoursPerDay)&&void 0!==r?r:i.hoursPerDay,o=Math.floor(n%60),c=Math.floor(n/60),s=c%a,f=Math.floor(c/a),l=0;n<1&&(l=Math.round(60*n),o=0);var p="";return f>0&&(p+=f+"d"),s>0&&(p+=s+"h"),o>0&&(p+=o+"m"),l>0&&(p+=l+"s"),p}function f(n){return 60*n*1e3}function l(n){return f(60*n)}function p(n){return n/1e3/60}},8282:function(n,t,e){e.d(t,{j:function(){return c},m:function(){return f}});var r=e(8214),u=e(5861),a=e(4305),o=e(5728),i=e(9697);function c(n,t){return s.apply(this,arguments)}function s(){return s=(0,u.Z)((0,r.Z)().mark((function n(t,e){var c,s,f,l,p,d;return(0,r.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,a.TO)(t);case 2:if(f=n.sent,void 0!==(l=f[f.length-1])&&void 0===l.endDate){n.next=6;break}return n.abrupt("return",null===(c=e.action)||void 0===c?void 0:c.call(e));case 6:if(!((p=(0,i.ne)(l.startDate))<(0,o.fg)(2*e.hoursPerDay))){n.next=9;break}return n.abrupt("return",null===(s=e.action)||void 0===s?void 0:s.call(e));case 9:return d=(0,o.yz)((0,o.do)(p),{hoursPerDay:24}),n.abrupt("return",new Promise((function(n,o){t.popup({type:"confirm",title:"Close old session?",message:"The current session looks old (".concat(d,"), do you want to close it and open a new one to save this work?"),confirmText:"Yes",onConfirm:function(){var o=(0,u.Z)((0,r.Z)().mark((function u(o){var i;return(0,r.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return l.endDate=new Date,r.next=3,(0,a.qH)(t,f);case 3:return n(null===(i=e.action)||void 0===i?void 0:i.call(e)),r.next=6,o.closePopup();case 6:case"end":return r.stop()}}),u)})));return function(n){return o.apply(this,arguments)}}(),cancelText:"No",onCancel:function(t){var r;return n(null===(r=e.action)||void 0===r?void 0:r.call(e)),t.closePopup()},mouseEvent:e.mouseEvent.nativeEvent})})));case 11:case"end":return n.stop()}}),n)}))),s.apply(this,arguments)}function f(n,t){return c(n,{action:function(){return(0,a.tm)(n,t.action)},hoursPerDay:t.hoursPerDay,mouseEvent:t.mouseEvent})}}}]);
//# sourceMappingURL=880.d0cf9213.chunk.js.map