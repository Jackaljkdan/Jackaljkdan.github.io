"use strict";(self.webpackChunkestimate_powerup=self.webpackChunkestimate_powerup||[]).push([[914],{732:function(e,n,t){t.d(n,{b:function(){return k}});var r=t(8214),u=t(4942),a=t(1413),o=t(5861),i=(t(2791),t(6258)),c=t(4303),s=t(4305),l=t(1166),d=t(5728);function f(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;return e.length<n?e:e.substring(0,n-3)+"..."}var v=t(146),p=t(6683),m=t(9697),h=t(8282),w=t(184);function k(e){var n,t,k,x,Z=(0,v.D)(),b=(0,i.k)(),y=(0,l.DP)(null===(n=b.value)||void 0===n?void 0:n.startDate),M=(0,c.th)("id"),g=(0,c.lg)(Z,null===(t=b.value)||void 0===t?void 0:t.cardId,"id","name"),E=(0,p.K)(Z,"id"),D=void 0!==(null===(k=b.value)||void 0===k?void 0:k.cardId)&&!b.isSaving;return M||D?(0,w.jsxs)("div",{className:"work-button-wrapper",children:[(0,w.jsxs)("button",{className:"work-button ".concat(D?"mod-danger":"mod-primary"),onClick:function(){var n=(0,o.Z)((0,r.Z)().mark((function n(t){var i,c,l,f,v;return(0,r.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(void 0!==E){n.next=2;break}return n.abrupt("return");case 2:if(D||void 0===M){n.next=7;break}b.set({cardId:M.id,startDate:new Date}),(0,h.D3)(Z,{hoursPerDay:d.xZ,mouseEvent:t}),n.next=19;break;case 7:if(!D){n.next=19;break}return l=Math.round((0,m.qG)(b.value.startDate)),f=l/60,b.set(null),n.next=13,(0,s.oc)(Z,b.value.cardId);case 13:return v=n.sent,n.next=16,(0,s.Eo)(Z,(0,a.Z)((0,a.Z)({},v),{},{workMinutes:(0,a.Z)((0,a.Z)({},v.workMinutes),{},(0,u.Z)({},E.id,(null!==(i=v.workMinutes[E.id])&&void 0!==i?i:0)+f))}),b.value.cardId);case 16:return n.next=18,(0,h.mY)(Z,{action:function(){var e=(0,o.Z)((0,r.Z)().mark((function e(n){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return 0===n.workMinutes&&(n.startDate=(0,m.HH)(n.startDate,-f)),n.workMinutes+=f,e.abrupt("return",n);case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),hoursPerDay:d.xZ,mouseEvent:t});case 18:null===(c=e.onEstimateChanged)||void 0===c||c.call(e);case 19:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),children:[b.isSaving?"...":null,b.isSaving?null:[D?"End work":"Start work",D?" "+(0,d.yz)(y,{zero:""}):null,D&&(null===M||void 0===M?void 0:M.id)!==(null===(x=b.value)||void 0===x?void 0:x.cardId)?" (on".concat(M?" other":""," card").concat(void 0===g?"":': "'.concat(f(g.name,8),'"'),")"):null]]}),D?(0,w.jsx)("button",{className:"cancel-work-button",onClick:function(e){return Z.popup({type:"confirm",title:"Cancel work?",message:"Are you sure you want to cancel the work in progress?",confirmText:"Yes",onConfirm:function(e){return b.set(null),e.closePopup()},cancelText:"No",onCancel:function(e){return e.closePopup()},mouseEvent:e.nativeEvent})},children:"X"}):null]}):null}},4303:function(e,n,t){t.d(n,{Fo:function(){return v},lg:function(){return w},nb:function(){return m},th:function(){return h}});var r=t(7762),u=t(885),a=t(1413),o=t(8214),i=t(5861),c=t(2791),s=t(1933),l=t(5678),d=t(146),f=t(9416);function v(e){var n="card",t=(0,s.useQueryClient)(),r=(0,s.useQuery)(n,(0,i.Z)((0,o.Z)().mark((function n(){var t;return(0,o.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.card("dueComplete");case 2:return t=n.sent,n.abrupt("return",t.dueComplete);case 4:case"end":return n.stop()}}),n)}))),{staleTime:1e3}),u=(0,c.useCallback)((function(e){return t.setQueryData(n,e)}),[t]);return(0,c.useMemo)((function(){return(0,a.Z)((0,a.Z)({},r),{},{setData:u})}),[r,u])}function p(e){for(var n=arguments.length,t=new Array(n>1?n-1:0),r=1;r<n;r++)t[r-1]=arguments[r];var a=(0,c.useState)(),s=(0,u.Z)(a,2),d=s[0],v=s[1],p=(0,c.useCallback)((0,i.Z)((0,o.Z)().mark((function n(){var r;return(0,o.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,e.card.apply(e,t);case 3:r=n.sent,n.next=10;break;case 6:return n.prev=6,n.t0=n.catch(0),console.warn("no card in context"),n.abrupt("return");case 10:v(r);case 11:case"end":return n.stop()}}),n,null,[[0,6]])}))),l.w);return(0,f.cM)(e,p),(0,c.useMemo)((function(){return{card:d,refresh:p,setCard:v}}),[d])}function m(e){for(var n=arguments.length,t=new Array(n>1?n-1:0),r=1;r<n;r++)t[r-1]=arguments[r];var u=p.apply(void 0,[e].concat(t)),a=u.card;return a}function h(){for(var e=(0,d.D)(),n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];return m.apply(void 0,[e].concat(t))}function w(e,n){for(var t=arguments.length,a=new Array(t>2?t-2:0),s=2;s<t;s++)a[s-2]=arguments[s];var l=(0,c.useState)(),d=(0,u.Z)(l,2),f=d[0],v=d[1];return(0,c.useEffect)((function(){function t(){return u.apply(this,arguments)}function u(){return(u=(0,i.Z)((0,o.Z)().mark((function t(){var u,i,c,s;return(0,o.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0!==n){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,e.cards.apply(e,a);case 4:u=t.sent,i=(0,r.Z)(u),t.prev=6,i.s();case 8:if((c=i.n()).done){t.next=15;break}if((s=c.value).id!==n){t.next=13;break}return v(s),t.abrupt("break",15);case 13:t.next=8;break;case 15:t.next=20;break;case 17:t.prev=17,t.t0=t.catch(6),i.e(t.t0);case 20:return t.prev=20,i.f(),t.finish(20);case 23:case"end":return t.stop()}}),t,null,[[6,17,20,23]])})))).apply(this,arguments)}t(),e.render(t)}),[n]),f}},6258:function(e,n,t){t.d(n,{k:function(){return m}});var r=t(8214),u=t(5861),a=t(885),o=t(2791),i=t(1933),c=t(4305),s=t(8286),l=t(1640),d=t(5728),f=t(146),v=t(9416),p="current_work";function m(){var e=(0,f.D)(),n=(0,i.useQueryClient)(),t=function(e){var n=(0,i.useQuery)(p,(function(){return(0,c.X8)(e)}),{staleTime:(0,d.y2)(2),cacheTime:1/0,refetchOnMount:!1,refetchOnReconnect:!1,refetchOnWindowFocus:!1});return(0,v.he)(e,{refresh:n.refetch,callImmediately:!1}),(0,l.D)((function(){var e=s.W.on(n.refetch);return function(){return s.W.off(e)}})),n}(e),m=(0,o.useState)(!1),h=(0,a.Z)(m,2),w=h[0],k=h[1],x=(0,o.useCallback)(function(){var t=(0,u.Z)((0,r.Z)().mark((function t(u){return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return k(!0),t.next=3,(0,c.w9)(e,u);case 3:n.setQueryData(p,u),k(!1);case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),[e,n]);return(0,o.useMemo)((function(){return{value:t.data,isSaving:w,set:x}}),[t.data,w,x])}},1166:function(e,n,t){t.d(n,{DP:function(){return o}});var r=t(885),u=t(2791),a=t(9697);function o(e){return i(e)/1e3/60}function i(e){var n=(0,u.useState)(0),t=(0,r.Z)(n,2),o=t[0],i=t[1];return(0,u.useEffect)((function(){if(void 0!==e){var n,t=!1;return n=requestAnimationFrame((function r(){i((0,a.ne)(e)),t||(n=requestAnimationFrame(r))})),function(){t=!0,cancelAnimationFrame(n)}}i(0)}),[e]),o}},6683:function(e,n,t){t.d(n,{K:function(){return o}});var r=t(2982),u=t(885),a=t(2791);function o(e){for(var n=arguments.length,t=new Array(n>1?n-1:0),o=1;o<n;o++)t[o-1]=arguments[o];var i=(0,a.useState)(),c=(0,u.Z)(i,2),s=c[0],l=c[1];return(0,a.useEffect)((function(){var n=void 0!==t&&t.length>0?t:["id"];e.member.apply(e,(0,r.Z)(n)).then((function(e){return l(e)}))}),[e]),s}},146:function(e,n,t){var r;function u(){return void 0===r&&(r=window.TrelloPowerUp.iframe({appName:"Estimate",appKey:"dadac0f685db6faecaa69b90f19ba321"})),r}t.d(n,{D:function(){return u}})},9416:function(e,n,t){t.d(n,{cM:function(){return a},he:function(){return u}});var r=t(1640);function u(e,n){(0,r.D)((function(){n.callImmediately&&n.refresh(),e.render(n.refresh)}))}function a(e,n){return u(e,{refresh:n,callImmediately:!0})}},1640:function(e,n,t){t.d(n,{D:function(){return a}});var r=t(2791),u=t(5678);function a(e){return(0,r.useEffect)(e,u.w)}},5678:function(e,n,t){t.d(n,{w:function(){return r}});var r=[]},914:function(e,n,t){t.r(n),t.d(n,{default:function(){return z}});var r=t(1413),u=t(885),a=t(2791),o=t(5728),i=t(6683),c=t(8214),s=t(5861),l=t(4305),d=t(5678);var f=t(732),v=t(4303),p=t(146);var m=(0,c.Z)().mark(h);function h(e){var n;return(0,c.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.t0=(0,c.Z)().keys(e);case 1:if((t.t1=t.t0()).done){t.next=7;break}return n=t.t1.value,t.next=5,n;case 5:t.next=1;break;case 7:case"end":return t.stop()}}),m)}var w="https://api.trello.com/1",k="dadac0f685db6faecaa69b90f19ba321";function x(e,n,t){var u,a=(0,r.Z)((0,r.Z)({},t),{},{key:k,token:e}),o=Array.from(h(a),(function(e){return e+"="+a[e]})).join("&");return u={url:w+"/cards/".concat(n,"?").concat(o),method:"PUT"},fetch(u.url,(0,r.Z)((0,r.Z)({},u),{},{headers:(0,r.Z)({Accept:"application/json"},null===u||void 0===u?void 0:u.headers)})).then((function(e){return e.json().then((function(n){var t=e;return t.data=n,t.request=u,t}))}))}var Z=t(184);function b(e){var n=(0,p.D)(),t=(0,v.nb)(n,"id","due"),r=(0,v.Fo)(n);return(0,Z.jsxs)("button",{className:"complete-work ".concat(e.className),onClick:function(){void 0!==t&&function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"read,write";return e.getRestApi().isAuthorized().then((function(e){if(!e)throw new Error("unauthorized")})).catch((function(){return e.getRestApi().authorize({scope:n})})).then((function(){return e.getRestApi().getToken()}))}(n).then((function(e){return x(e,t.id,{due:r.data?null:t.due?t.due:(new Date).toISOString(),dueComplete:!r.data})})).then((function(e){e.ok&&r.setData(e.data.dueComplete)})).catch((function(e){console.error(e)}))},children:[void 0===r.data?"loading...":null,void 0!==r.data?[r.data?"Uncomplete card":null,r.data?null:"Complete card"]:null]})}var y=t(6258);function M(e){var n,t=(0,p.D)(),r=(0,y.k)(),u=(0,v.nb)(t,"id");return void 0===(null===(n=r.value)||void 0===n?void 0:n.cardId)||void 0===u||r.value.cardId===u.id?null:(0,Z.jsx)("button",{className:"open-work ".concat(e.className),onClick:function(){return t.showCard(r.value.cardId)},children:"Open work card"})}var g=t(9416);function E(e){var n,t,r,u;return(0,Z.jsxs)("div",{className:"time-buttons ".concat(null!==(n=e.className)&&void 0!==n?n:""),children:[(0,Z.jsx)("div",{className:"label",children:e.label}),(0,Z.jsx)("button",{onClick:function(n){return e.action(n,(function(e,n){return n}))},children:null!==(t=e.setLabel)&&void 0!==t?t:"Set"}),(0,Z.jsx)("button",{onClick:function(n){return e.action(n,(function(e,n){return e+n}))},children:"+"}),(0,Z.jsx)("button",{onClick:function(n){return e.action(n,(function(e,n){return e-n}))},children:"-"}),null===(r=e.showClear)||void 0===r||r?(0,Z.jsx)("button",{onClick:e.clearAction,children:null!==(u=e.clearLabel)&&void 0!==u?u:"Clear"}):null]})}var D=t(9697),C={isApplicable:function(){var e=(0,s.Z)((0,c.Z)().mark((function e(n){return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=Boolean,e.next=3,(0,l.bS)(n);case 3:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 5:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),getTitle:function(){var e=(0,s.Z)((0,c.Z)().mark((function e(n){var t,r;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,l.bS)(n);case 2:return t=e.sent,r=(0,D.Zd)(t),e.abrupt("return","Add time since last input as work (".concat((0,o.JB)(r),")"));case 5:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),call:function(){var e=(0,s.Z)((0,c.Z)().mark((function e(n){var t,r;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,l.bS)(n);case 2:return t=e.sent,e.next=5,n.card("id");case 5:return r=e.sent,e.next=8,(0,l.s9)(n,(0,D.Zd)(t),r.id);case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()},S=t(2168),j=t(9005),A={isApplicable:function(){var e=(0,s.Z)((0,c.Z)().mark((function e(n){var t,r;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=(0,S.b)()){e.next=3;break}return e.abrupt("return",!1);case 3:return e.next=5,(0,l.X8)(n);case 5:if(null!==(r=e.sent)&&void 0!==r&&r.startDate){e.next=8;break}return e.abrupt("return",!1);case 8:return e.abrupt("return",t>r.startDate);case 9:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),getTitle:function(){var e=(0,s.Z)((0,c.Z)().mark((function e(n){var t,r,u;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,l.X8)(n);case 2:return t=e.sent,r=(0,S.b)(),u=(0,D.oE)(t.startDate,r),e.abrupt("return","I forgot to end work before closing (close time: ".concat((0,j.p)(r,"yyyy-MM-dd hh:mm:ss")," work: ").concat((0,o.JB)(u),")"));case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),call:function(){var e=(0,s.Z)((0,c.Z)().mark((function e(n){var t,r,u;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,l.X8)(n);case 2:return t=e.sent,r=(0,S.b)(),u=(0,D.oE)(t.startDate,r),e.next=7,(0,l.s9)(n,u,t.cardId);case 7:return e.next=9,(0,l.w9)(n,null);case 9:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()};function N(e){var n,t=(0,p.D)();function r(e,n){return u.apply(this,arguments)}function u(){return u=(0,s.Z)((0,c.Z)().mark((function n(r,u){return(0,c.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,u.isApplicable(t);case 2:if(n.sent){n.next=4;break}return n.abrupt("return");case 4:return n.t0=r,n.next=7,u.getTitle(t);case 7:n.t1=n.sent,n.t2=function(){var n=(0,s.Z)((0,c.Z)().mark((function n(r){var a;return(0,c.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,u.call(t);case 2:return null===(a=e.onRefresh)||void 0===a||a.call(e),n.next=5,r.closePopup();case 5:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),n.t3={text:n.t1,callback:n.t2},n.t0.push.call(n.t0,n.t3);case 11:case"end":return n.stop()}}),n)}))),u.apply(this,arguments)}return(0,Z.jsx)("button",{className:"".concat(null!==(n=e.className)&&void 0!==n?n:""),onClick:function(){var e=(0,s.Z)((0,c.Z)().mark((function e(n){var u;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=[],e.next=3,r(u,C);case 3:return e.next=5,r(u,A);case 5:t.popup({title:"More functions",items:u,mouseEvent:n.nativeEvent});case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),children:"\u22ef"})}var P=t(4942),T=t(8282),I=t(2982),B=t(7762),J=t(1166),F=t(3265);function O(e){var n,t,r,i,c=e.estimate,s=e.member,d=(0,a.useState)(!1),f=(0,u.Z)(d,2),m=f[0],h=f[1],w=(0,a.useState)(),k=(0,u.Z)(w,2),x=k[0],b=k[1],M=(0,p.D)(),g=(0,v.nb)(M,"id"),E=null!==(n=(0,v.Fo)(M).data)&&void 0!==n&&n,D=(0,y.k)(),C=(0,J.DP)((null===(t=D.value)||void 0===t?void 0:t.cardId)===(null===g||void 0===g?void 0:g.id)?null===(r=D.value)||void 0===r?void 0:r.startDate:void 0);(0,a.useEffect)((function(){m&&void 0===x&&M.board("members").then((function(e){var n,t={},r=(0,B.Z)(e.members);try{for(r.s();!(n=r.n()).done;){var u=n.value;t[u.id]=u}}catch(a){r.e(a)}finally{r.f()}b(t)}))}),[m,x]);var S=(0,l.y7)(c)+C,j=null!==(i=C+c.workMinutes[s.id])&&void 0!==i?i:0,A=(0,l.V9)(c,E,S);return(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsxs)("div",{className:"card-label",children:["Work: ",(0,o.JB)(S)," ",j<S?["(mine: ",(0,o.JB)(j),")"]:null," ",j<S?(0,Z.jsx)("span",{className:"work-details link-like",onClick:function(){return h((function(e){return!e}))},children:"details"}):null,E?null:[" | "," Remaining: ",(0,o.JB)(A)],E?[" | ",(0,F.W)({delta:(0,F.M)({cardId:null===g||void 0===g?void 0:g.id,estimate:c,totalWorkMinutes:S})})]:null]}),m&&void 0!==x?(0,Z.jsx)("div",{children:(0,I.Z)((0,l.Wm)(c)).filter((function(e){return e.minutes>0})).map((function(e){var n,t=x[e.memberId];return(0,Z.jsxs)("div",{children:[null!==(n=null===t||void 0===t?void 0:t.fullName)&&void 0!==n?n:"<missing>",t&&" ",void 0!==t?"(".concat(t.username,")"):"",": ",(0,o.JB)(e.minutes)]},e.memberId)}))}):null]})}function R(e){var n,t=e.estimate,u=e.member,a=(0,p.D)();if(void 0===t.value)return(0,Z.jsx)("div",{children:t.feedback});var i=(0,l.y7)(t.value),d=null!==(n=t.value.workMinutes[u.id])&&void 0!==n?n:0;function f(e){return v.apply(this,arguments)}function v(){return v=(0,s.Z)((0,c.Z)().mark((function e(n){var t,i;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.action();case 2:if(t=e.sent){e.next=5;break}return e.abrupt("return");case 5:if(void 0!==(i=t.workMinutes[u.id])){e.next=8;break}return e.abrupt("return");case 8:a.popup({type:"confirm",title:"Add to session?",message:"Should this work change count in your work session?",confirmText:"Yes",onConfirm:function(e){return e.closePopup(),(0,T.mY)(a,{action:function(){var e=(0,s.Z)((0,c.Z)().mark((function e(n){return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,r.Z)((0,r.Z)({},n),{},{workMinutes:n.workMinutes+i}));case 1:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),hoursPerDay:o.xZ,mouseEvent:n.mouseEvent})},cancelText:"No",onCancel:function(e){return e.closePopup()},mouseEvent:n.mouseEvent.nativeEvent});case 9:case"end":return e.stop()}}),e)}))),v.apply(this,arguments)}return(0,Z.jsx)(E,{label:(0,Z.jsx)(O,{estimate:t.value,member:u}),action:function(n,i){return f({action:function(){return(0,o.MG)(a,e.inputState,(function(e){return t.set((function(n){var t;return(0,r.Z)((0,r.Z)({},n),{},{workMinutes:(0,r.Z)((0,r.Z)({},n.workMinutes),{},(0,P.Z)({},u.id,i(null!==(t=n.workMinutes[u.id])&&void 0!==t?t:0,e)))})}))}))},mouseEvent:n})},showClear:i>0,clearAction:function(e){a.popup({type:"confirm",title:"Clear?",message:"Are you sure you want to clear the work (".concat((0,o.JB)(i),")?"),confirmText:"Yes",onConfirm:function(){var n=(0,s.Z)((0,c.Z)().mark((function n(a){return(0,c.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,f({action:function(){return t.set((function(e){return(0,r.Z)((0,r.Z)({},e),{},{workMinutes:(0,r.Z)((0,r.Z)({},e.workMinutes),{},(0,P.Z)({},u.id,0))})}))},mouseEvent:e});case 2:return n.next=4,a.closePopup();case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),cancelText:"No",onCancel:function(e){return e.closePopup()},mouseEvent:e.nativeEvent})},clearLabel:d<i?"Clear mine":void 0,setLabel:d<i?"Set mine":void 0,className:e.className})}function z(){var e=(0,p.D)(),n=function(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],t=(0,a.useState)(),r=(0,u.Z)(t,2),o=r[0],i=r[1],f=(0,a.useState)(""),v=(0,u.Z)(f,2),p=v[0],m=v[1],h=(0,a.useMemo)((function(){return(0,s.Z)((0,c.Z)().mark((function n(){var t;return(0,c.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return m("loading..."),n.next=3,(0,l.oc)(e);case 3:t=n.sent,i(t),m("");case 6:case"end":return n.stop()}}),n)})))}),d.w),w=(0,a.useMemo)((function(){return function(t){if(void 0!==o){var r=t(o),u={estimateMinutes:r.estimateMinutes-o.estimateMinutes,updatedEstimateMinutes:r.updatedEstimateMinutes-o.updatedEstimateMinutes,workMinutes:{}};for(var a in r.workMinutes){var c;u.workMinutes[a]=r.workMinutes[a]-(null!==(c=o.workMinutes[a])&&void 0!==c?c:0)}if(n)return m("saving..."),(0,l.oc)(e).then((function(n){var t={estimateMinutes:n.estimateMinutes+u.estimateMinutes,updatedEstimateMinutes:n.updatedEstimateMinutes+u.updatedEstimateMinutes,workMinutes:{}};for(var r in u.workMinutes){var a;t.workMinutes[r]=(null!==(a=n.workMinutes[r])&&void 0!==a?a:0)+u.workMinutes[r]}return(0,l.Eo)(e,t)})).then((function(e){return i(e),m("saved!"),setTimeout((function(){return m("")}),1e3),u})).catch((function(n){m(""),e.alert({display:"error",message:"error during save: ".concat(n)})}))}}}),[o,n]);return(0,a.useMemo)((function(){return{value:o,set:w,feedback:p,refresh:h}}),[o,p])}(e),t=(0,a.useState)(""),v=(0,u.Z)(t,2),m=v[0],h=v[1],w=(0,i.K)(e,"id");if((0,g.cM)(e,n.refresh),void 0===n.value)return(0,Z.jsx)("div",{children:n.feedback});var k=0!==n.value.updatedEstimateMinutes&&n.value.updatedEstimateMinutes!==n.value.estimateMinutes;return(0,Z.jsxs)("div",{children:[(0,Z.jsxs)("div",{className:"card-input-header",children:[(0,Z.jsx)("input",{value:m,onChange:function(e){return h(e.target.value)},placeholder:"input for all buttons..."}),(0,Z.jsx)(f.b,{onEstimateChanged:n.refresh}),(0,Z.jsxs)("div",{className:"top-right",children:[(0,Z.jsx)(M,{}),(0,Z.jsx)(b,{}),(0,Z.jsx)(N,{onRefresh:n.refresh})]})]}),(0,Z.jsx)(E,{label:(0,Z.jsxs)(Z.Fragment,{children:[k&&"Original ","Estimate: ",(0,o.JB)(n.value.estimateMinutes),k?[" | ","Updated: ",(0,o.JB)(n.value.updatedEstimateMinutes)]:null]}),action:function(u,a){return(0,o.MG)(e,t,(function(t){0!==n.value.estimateMinutes||k?e.popup({type:"confirm",title:"Update estimate?",message:"Do you want to update the estimate or change the original?",confirmText:"Update",onConfirm:function(e){return n.set((function(e){return(0,r.Z)((0,r.Z)({},e),{},{updatedEstimateMinutes:a((0,l.zR)(e),t)})})),e.closePopup()},cancelText:"Change original",onCancel:function(e){return n.set((function(e){return(0,r.Z)((0,r.Z)({},e),{},{estimateMinutes:a((0,l.zR)(e),t),updatedEstimateMinutes:0})})),e.closePopup()},mouseEvent:u.nativeEvent}):n.set((function(e){return(0,r.Z)((0,r.Z)({},e),{},{estimateMinutes:a(e.estimateMinutes,t)})}))}))},clearAction:function(){return n.set((function(e){return(0,r.Z)((0,r.Z)({},e),{},{estimateMinutes:0,updatedEstimateMinutes:0})}))}}),void 0!==w?(0,Z.jsx)(R,{estimate:n,member:w,inputState:t,className:"work"}):null,Boolean(n.feedback)?(0,Z.jsx)("div",{children:n.feedback}):null]})}},9005:function(e,n,t){function r(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"yyyy-MM-dd";return n.replaceAll("yyyy",e.getFullYear().toString()).replaceAll("MM",(e.getMonth()+1).toString().padStart(2,"0")).replaceAll("dd",e.getDate().toString().padStart(2,"0")).replaceAll("hh",e.getHours().toString().padStart(2,"0")).replaceAll("mm",e.getMinutes().toString().padStart(2,"0")).replaceAll("ss",e.getSeconds().toString().padStart(2,"0"))}t.d(n,{p:function(){return r}})},2168:function(e,n,t){t.d(n,{Q:function(){return a},b:function(){return o}});var r=t(9005),u="exit.datetime";function a(){window.addEventListener("pagehide",(function(e){localStorage.setItem(u,JSON.stringify(new Date))}));var e=o();console.log(u+": "+(e?(0,r.p)(e,"yyyy-MM-dd hh:mm:ss"):"null"))}function o(){var e=JSON.parse(localStorage.getItem(u));return e?new Date(e):null}},8282:function(e,n,t){t.d(n,{D3:function(){return l},mY:function(){return d}});var r=t(8214),u=t(5861),a=t(4305),o=t(5728),i=t(9697);function c(e,n){return s.apply(this,arguments)}function s(){return s=(0,u.Z)((0,r.Z)().mark((function e(n,t){var c,s,l,d,f,v;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,a.TO)(n);case 2:if(l=e.sent,void 0!==(d=l[l.length-1])&&void 0===d.endDate){e.next=6;break}return e.abrupt("return",null===(c=t.action)||void 0===c?void 0:c.call(t));case 6:if(!((f=(0,i.ne)(d.startDate))<(0,o.fg)(2*t.hoursPerDay))){e.next=9;break}return e.abrupt("return",null===(s=t.action)||void 0===s?void 0:s.call(t));case 9:return v=(0,o.yz)((0,o.do)(f),{hoursPerDay:24}),e.abrupt("return",new Promise((function(e,o){n.popup({type:"confirm",title:"Close old session?",message:"The current session looks old (".concat(v,"), do you want to close it and open a new one to save this work?"),confirmText:"Yes",onConfirm:function(){var o=(0,u.Z)((0,r.Z)().mark((function u(o){var i;return(0,r.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return d.endDate=new Date,r.next=3,(0,a.qH)(n,l);case 3:return e(null===(i=t.action)||void 0===i?void 0:i.call(t)),r.next=6,o.closePopup();case 6:case"end":return r.stop()}}),u)})));return function(e){return o.apply(this,arguments)}}(),cancelText:"No",onCancel:function(n){var r;return e(null===(r=t.action)||void 0===r?void 0:r.call(t)),n.closePopup()},mouseEvent:t.mouseEvent.nativeEvent})})));case 11:case"end":return e.stop()}}),e)}))),s.apply(this,arguments)}function l(e,n){return c(e,{hoursPerDay:n.hoursPerDay,mouseEvent:n.mouseEvent,action:function(){var t=(0,u.Z)((0,r.Z)().mark((function t(){var o;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,a.tm)(e,function(){var e=(0,u.Z)((0,r.Z)().mark((function e(n){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n);case 1:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}());case 2:null===(o=n.action)||void 0===o||o.call(n);case 3:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()})}function d(e,n){return c(e,{action:function(){return(0,a.tm)(e,n.action)},hoursPerDay:n.hoursPerDay,mouseEvent:n.mouseEvent})}}}]);
//# sourceMappingURL=914.ec2d2b76.chunk.js.map