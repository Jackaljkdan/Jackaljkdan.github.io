"use strict";(self.webpackChunkestimate_powerup=self.webpackChunkestimate_powerup||[]).push([[775],{914:function(e,t,n){n.r(t),n.d(t,{default:function(){return O}});var r=n(1413),u=n(885),a=n(2791),i=n(5728),o=n(6683),s=n(8214),c=n(5861),l=n(4305),d=n(5678);var f=n(732),v=n(4303),p=n(146);var m=(0,s.Z)().mark(h);function h(e){var t;return(0,s.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:n.t0=(0,s.Z)().keys(e);case 1:if((n.t1=n.t0()).done){n.next=7;break}return t=n.t1.value,n.next=5,t;case 5:n.next=1;break;case 7:case"end":return n.stop()}}),m)}var k="https://api.trello.com/1",Z="dadac0f685db6faecaa69b90f19ba321";function x(e,t,n){var u,a=(0,r.Z)((0,r.Z)({},n),{},{key:Z,token:e}),i=Array.from(h(a),(function(e){return e+"="+a[e]})).join("&");return u={url:k+"/cards/".concat(t,"?").concat(i),method:"PUT"},fetch(u.url,(0,r.Z)((0,r.Z)({},u),{},{headers:(0,r.Z)({Accept:"application/json"},null===u||void 0===u?void 0:u.headers)})).then((function(e){return e.json().then((function(t){var n=e;return n.data=t,n.request=u,n}))}))}var w=n(184);function b(e){var t=(0,p.D)(),n=(0,v.nb)(t,"id","due"),r=(0,v.Fo)(t);return(0,w.jsxs)("button",{className:"complete-work ".concat(e.className),onClick:function(){void 0!==n&&function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"read,write";return e.getRestApi().isAuthorized().then((function(e){if(!e)throw new Error("unauthorized")})).catch((function(){return e.getRestApi().authorize({scope:t})})).then((function(){return e.getRestApi().getToken()}))}(t).then((function(e){return x(e,n.id,{due:r.data?null:n.due?n.due:(new Date).toISOString(),dueComplete:!r.data})})).then((function(e){e.ok&&r.setData(e.data.dueComplete)})).catch((function(e){console.error(e)}))},children:[void 0===r.data?"loading...":null,void 0!==r.data?[r.data?"Uncomplete card":null,r.data?null:"Complete card"]:null]})}var M=n(6258);function g(e){var t,n=(0,p.D)(),r=(0,M.k)(),u=(0,v.nb)(n,"id");return void 0===(null===(t=r.value)||void 0===t?void 0:t.cardId)||void 0===u||r.value.cardId===u.id?null:(0,w.jsx)("button",{className:"open-work ".concat(e.className),onClick:function(){return n.showCard(r.value.cardId)},children:"Open work card"})}var y=n(9416);function j(e){var t,n,r;return(0,w.jsxs)("div",{className:"time-buttons ".concat(null!==(t=e.className)&&void 0!==t?t:""),children:[(0,w.jsx)("div",{className:"label",children:e.label}),(0,w.jsx)("button",{onClick:function(t){return e.action(t,(function(e,t){return t}))},children:null!==(n=e.setLabel)&&void 0!==n?n:"Set"}),(0,w.jsx)("button",{onClick:function(t){return e.action(t,(function(e,t){return e+t}))},children:"+"}),(0,w.jsx)("button",{onClick:function(t){return e.action(t,(function(e,t){return e-t}))},children:"-"}),(0,w.jsx)("button",{onClick:e.clearAction,children:null!==(r=e.clearLabel)&&void 0!==r?r:"Clear"})]})}var E=n(4942),C=n(9697),N={isApplicable:function(){var e=(0,c.Z)((0,s.Z)().mark((function e(t){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=Boolean,e.next=3,(0,l.bS)(t);case 3:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),getTitle:function(){var e=(0,c.Z)((0,s.Z)().mark((function e(t){var n,r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,l.bS)(t);case 2:return n=e.sent,r=(0,C.Zd)(n),e.abrupt("return","Add time since last input as work (".concat((0,i.JB)(r),")"));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),call:function(){var e=(0,c.Z)((0,s.Z)().mark((function e(t){var n,u,a,i,o;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,l.bS)(t);case 2:return u=e.sent,e.next=5,t.card("id");case 5:return a=e.sent,e.next=8,t.member("id");case 8:return i=e.sent,e.next=11,(0,l.oc)(t,a.id);case 11:return o=e.sent,e.next=14,(0,l.Eo)(t,(0,r.Z)((0,r.Z)({},o),{},{workMinutes:(0,r.Z)((0,r.Z)({},o.workMinutes),{},(0,E.Z)({},i.id,(null!==(n=o.workMinutes[i.id])&&void 0!==n?n:0)+(0,C.Zd)(u)))}));case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},S=n(2168),D=n(9005),A={isApplicable:function(){var e=(0,c.Z)((0,s.Z)().mark((function e(t){var n,r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=(0,S.b)()){e.next=3;break}return e.abrupt("return",!1);case 3:return e.next=5,(0,l.X8)(t);case 5:if(null!==(r=e.sent)&&void 0!==r&&r.startDate){e.next=8;break}return e.abrupt("return",!1);case 8:return e.abrupt("return",n>r.startDate);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),getTitle:function(){var e=(0,c.Z)((0,s.Z)().mark((function e(t){var n,r,u;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,l.X8)(t);case 2:return n=e.sent,r=(0,S.b)(),u=(0,C.oE)(n.startDate,r),e.abrupt("return","I forgot to end work before closing (close time: ".concat((0,D.p)(r,"yyyy-MM-dd hh:mm:ss")," work: ").concat((0,i.JB)(u),")"));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),call:function(){var e=(0,c.Z)((0,s.Z)().mark((function e(t){var n,u,a,i,o,c;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.member("id");case 2:return u=e.sent,e.next=5,(0,l.X8)(t);case 5:return a=e.sent,i=(0,S.b)(),o=(0,C.oE)(a.startDate,i),e.next=10,(0,l.oc)(t,a.cardId);case 10:return c=e.sent,e.next=13,(0,l.Eo)(t,(0,r.Z)((0,r.Z)({},c),{},{workMinutes:(0,r.Z)((0,r.Z)({},c.workMinutes),{},(0,E.Z)({},u.id,(null!==(n=c.workMinutes[u.id])&&void 0!==n?n:0)+o))}),a.cardId);case 13:return e.next=15,(0,l.w9)(t,null);case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()};function I(e){var t,n=(0,p.D)();function r(e,t){return u.apply(this,arguments)}function u(){return u=(0,c.Z)((0,s.Z)().mark((function t(r,u){return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u.isApplicable(n);case 2:if(t.sent){t.next=4;break}return t.abrupt("return");case 4:return t.t0=r,t.next=7,u.getTitle(n);case 7:t.t1=t.sent,t.t2=function(){var t=(0,c.Z)((0,s.Z)().mark((function t(r){var a;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u.call(n);case 2:return null===(a=e.onRefresh)||void 0===a||a.call(e),t.next=5,r.closePopup();case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),t.t3={text:t.t1,callback:t.t2},t.t0.push.call(t.t0,t.t3);case 11:case"end":return t.stop()}}),t)}))),u.apply(this,arguments)}return(0,w.jsx)("button",{className:"".concat(null!==(t=e.className)&&void 0!==t?t:""),onClick:function(){var e=(0,c.Z)((0,s.Z)().mark((function e(t){var u;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=[],e.next=3,r(u,N);case 3:return e.next=5,r(u,A);case 5:n.popup({title:"More functions",items:u,mouseEvent:t.nativeEvent});case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),children:"\u22ef"})}var B=n(8282),J=n(2982),T=n(7762),P=n(1166),R=n(3265);function z(e){var t,n,r,o,s=e.estimate,c=e.member,d=(0,a.useState)(!1),f=(0,u.Z)(d,2),m=f[0],h=f[1],k=(0,a.useState)(),Z=(0,u.Z)(k,2),x=Z[0],b=Z[1],g=(0,p.D)(),y=(0,v.nb)(g,"id"),j=null!==(t=(0,v.Fo)(g).data)&&void 0!==t&&t,E=(0,M.k)(),C=(0,P.DP)((null===(n=E.value)||void 0===n?void 0:n.cardId)===(null===y||void 0===y?void 0:y.id)?null===(r=E.value)||void 0===r?void 0:r.startDate:void 0);(0,a.useEffect)((function(){m&&void 0===x&&g.board("members").then((function(e){var t,n={},r=(0,T.Z)(e.members);try{for(r.s();!(t=r.n()).done;){var u=t.value;n[u.id]=u}}catch(a){r.e(a)}finally{r.f()}b(n)}))}),[m,x]);var N=(0,l.y7)(s)+C,S=null!==(o=C+s.workMinutes[c.id])&&void 0!==o?o:0,D=(0,l.V9)(s,j,N);return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)("div",{className:"card-label",children:["Work: ",(0,i.JB)(N)," ",S<N?["(mine: ",(0,i.JB)(S),")"]:null," ",S<N?(0,w.jsx)("span",{className:"work-details link-like",onClick:function(){return h((function(e){return!e}))},children:"details"}):null,j?null:[" | "," Remaining: ",(0,i.JB)(D)],j?[" | ",(0,R.W)({delta:(0,R.M)({cardId:null===y||void 0===y?void 0:y.id,estimate:s,totalWorkMinutes:N})})]:null]}),m&&void 0!==x?(0,w.jsx)("div",{children:(0,J.Z)((0,l.Wm)(s)).filter((function(e){return e.minutes>0})).map((function(e){var t,n=x[e.memberId];return(0,w.jsxs)("div",{children:[null!==(t=null===n||void 0===n?void 0:n.fullName)&&void 0!==t?t:"<missing>",n&&" ",void 0!==n?"(".concat(n.username,")"):"",": ",(0,i.JB)(e.minutes)]},e.memberId)}))}):null]})}function L(e){var t,n=e.estimate,u=e.member,a=(0,p.D)();if(void 0===n.value)return(0,w.jsx)("div",{children:n.feedback});var o=(0,l.y7)(n.value),d=null!==(t=n.value.workMinutes[u.id])&&void 0!==t?t:0;function f(e){return v.apply(this,arguments)}function v(){return v=(0,c.Z)((0,s.Z)().mark((function e(t){var n,o;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.action();case 2:if(n=e.sent){e.next=5;break}return e.abrupt("return");case 5:if(void 0!==(o=n.workMinutes[u.id])){e.next=8;break}return e.abrupt("return");case 8:a.popup({type:"confirm",title:"Add to session?",message:"Should this work change count in your work session?",confirmText:"Yes",onConfirm:function(e){return e.closePopup(),(0,B.mY)(a,{action:function(){var e=(0,c.Z)((0,s.Z)().mark((function e(t){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,r.Z)((0,r.Z)({},t),{},{workMinutes:t.workMinutes+o}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),hoursPerDay:i.xZ,mouseEvent:t.mouseEvent})},cancelText:"No",onCancel:function(e){return e.closePopup()},mouseEvent:t.mouseEvent.nativeEvent});case 9:case"end":return e.stop()}}),e)}))),v.apply(this,arguments)}return(0,w.jsx)(j,{label:(0,w.jsx)(z,{estimate:n.value,member:u}),action:function(t,o){return f({action:function(){return(0,i.MG)(a,e.inputState,(function(e){return n.set((function(t){var n;return(0,r.Z)((0,r.Z)({},t),{},{workMinutes:(0,r.Z)((0,r.Z)({},t.workMinutes),{},(0,E.Z)({},u.id,o(null!==(n=t.workMinutes[u.id])&&void 0!==n?n:0,e)))})}))}))},mouseEvent:t})},clearAction:function(e){return f({action:function(){return n.set((function(e){return(0,r.Z)((0,r.Z)({},e),{},{workMinutes:(0,r.Z)((0,r.Z)({},e.workMinutes),{},(0,E.Z)({},u.id,0))})}))},mouseEvent:e})},setLabel:d<o?"Set mine":void 0,clearLabel:d<o?"Clear mine":void 0,className:e.className})}function O(){var e=(0,p.D)(),t=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=(0,a.useState)(),r=(0,u.Z)(n,2),i=r[0],o=r[1],f=(0,a.useState)(""),v=(0,u.Z)(f,2),p=v[0],m=v[1],h=(0,a.useMemo)((function(){return(0,c.Z)((0,s.Z)().mark((function t(){var n;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return m("loading..."),t.next=3,(0,l.oc)(e);case 3:n=t.sent,o(n),m("");case 6:case"end":return t.stop()}}),t)})))}),d.w),k=(0,a.useMemo)((function(){return function(n){if(void 0!==i){var r=n(i),u={estimateMinutes:r.estimateMinutes-i.estimateMinutes,updatedEstimateMinutes:r.updatedEstimateMinutes-i.updatedEstimateMinutes,workMinutes:{}};for(var a in r.workMinutes){var s;u.workMinutes[a]=r.workMinutes[a]-(null!==(s=i.workMinutes[a])&&void 0!==s?s:0)}if(t)return m("saving..."),(0,l.oc)(e).then((function(t){var n={estimateMinutes:t.estimateMinutes+u.estimateMinutes,updatedEstimateMinutes:t.updatedEstimateMinutes+u.updatedEstimateMinutes,workMinutes:{}};for(var r in u.workMinutes){var a;n.workMinutes[r]=(null!==(a=t.workMinutes[r])&&void 0!==a?a:0)+u.workMinutes[r]}return(0,l.Eo)(e,n)})).then((function(e){return o(e),m("saved!"),setTimeout((function(){return m("")}),1e3),u})).catch((function(t){m(""),e.alert({display:"error",message:"error during save: ".concat(t)})}))}}}),[i,t]);return(0,a.useMemo)((function(){return{value:i,set:k,feedback:p,refresh:h}}),[i,p])}(e),n=(0,a.useState)(""),v=(0,u.Z)(n,2),m=v[0],h=v[1],k=(0,o.K)(e,"id");if((0,y.cM)(e,t.refresh),void 0===t.value)return(0,w.jsx)("div",{children:t.feedback});var Z=0!==t.value.updatedEstimateMinutes&&t.value.updatedEstimateMinutes!==t.value.estimateMinutes;return(0,w.jsxs)("div",{children:[(0,w.jsxs)("div",{className:"card-input-header",children:[(0,w.jsx)("input",{value:m,onChange:function(e){return h(e.target.value)},placeholder:"input for all buttons..."}),(0,w.jsx)(f.b,{onEstimateChanged:t.refresh}),(0,w.jsxs)("div",{className:"top-right",children:[(0,w.jsx)(g,{}),(0,w.jsx)(b,{}),(0,w.jsx)(I,{onRefresh:t.refresh})]})]}),(0,w.jsx)(j,{label:(0,w.jsxs)(w.Fragment,{children:[Z&&"Original ","Estimate: ",(0,i.JB)(t.value.estimateMinutes),Z?[" | ","Updated: ",(0,i.JB)(t.value.updatedEstimateMinutes)]:null]}),action:function(u,a){return(0,i.MG)(e,n,(function(n){0!==t.value.estimateMinutes||Z?e.popup({type:"confirm",title:"Update estimate?",message:"Do you want to update the estimate or change the original?",confirmText:"Update",onConfirm:function(e){return t.set((function(e){return(0,r.Z)((0,r.Z)({},e),{},{updatedEstimateMinutes:a((0,l.zR)(e),n)})})),e.closePopup()},cancelText:"Change original",onCancel:function(e){return t.set((function(e){return(0,r.Z)((0,r.Z)({},e),{},{estimateMinutes:a((0,l.zR)(e),n),updatedEstimateMinutes:0})})),e.closePopup()},mouseEvent:u.nativeEvent}):t.set((function(e){return(0,r.Z)((0,r.Z)({},e),{},{estimateMinutes:a(e.estimateMinutes,n)})}))}))},clearAction:function(){return t.set((function(e){return(0,r.Z)((0,r.Z)({},e),{},{estimateMinutes:0,updatedEstimateMinutes:0})}))}}),void 0!==k?(0,w.jsx)(L,{estimate:t,member:k,inputState:n,className:"work"}):null,Boolean(t.feedback)?(0,w.jsx)("div",{children:t.feedback}):null]})}},2168:function(e,t,n){n.d(t,{Q:function(){return a},b:function(){return i}});var r=n(9005),u="exit.datetime";function a(){window.addEventListener("pagehide",(function(e){localStorage.setItem(u,JSON.stringify(new Date))}));var e=i();console.log(u+": "+(e?(0,r.p)(e,"yyyy-MM-dd hh:mm:ss"):"null"))}function i(){var e=JSON.parse(localStorage.getItem(u));return e?new Date(e):null}}}]);
//# sourceMappingURL=775.cb438592.chunk.js.map